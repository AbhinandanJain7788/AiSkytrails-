 <!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
    }
    
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    
    .btn-primary {
      background-color: #0d6efd;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    
    .document-item.completed {
      background-color: #f0fff0;
    }
    
    #scrollable-documents::-webkit-scrollbar {
      display: none;
    }
    
    #scrollable-documents {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    
    .hover-scale {
      transition: transform 0.2s ease;
    }
    
    .hover-scale:hover {
      transform: scale(1.05);
    }

    .navbar-nav {
      gap: 1.5rem;
    }

    .document-type-label {
      min-width: 150px;
      font-weight: 500;
      margin-left: 10px;
      background-color: #f8f9fa;
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #dee2e6;
    }

    .preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 15px;
    }

    .preview-item {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #dee2e6;
    }

    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-pdf {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      color: #dc3545;
      font-size: 3rem;
    }

    .preview-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(220, 53, 69, 0.8);
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .file-info-container {
      display: flex;
      align-items: center;
      flex-grow: 1;
      min-width: 0;
    }

    .file-select-container {
      min-width: 200px;
      margin-left: 10px;
    }

    .upload-section {
      position: relative;
      min-height: 400px;
    }

    .document-preview {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .document-preview-item {
      width: 50px;
      height: 50px;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      border: 1px solid #ddd;
    }

    .document-preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .document-preview-remove {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(255,0,0,0.7);
      color: white;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 10px;
    }

   .preview-modal .modal-dialog {
      max-width: 30%;
      margin: 1rem auto;
    }

    .upload-status-indicator {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    .upload-complete-badge {
      position: absolute;
      top: 5px;
      left: 5px;
      background: #28a745;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }









    .uploading #upload-form {
      opacity: 0.5;
      pointer-events: none;
    }

    #upload-form {
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
        <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link text-primary fw-semibold" href="#">Apply Now</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Application</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Documents</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Premium Services</a>
          </li>
        </ul>
        <div class="d-none d-md-block ms-3">
          <img src="/docs/images/people/profile-picture-3.jpg" class="rounded-circle border border-secondary" width="40" height="40" alt="User" />
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row mb-4 align-items-center">
      <div class="col-lg-7 mb-4 mb-lg-0">
        <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
        <p class="mt-3 text-muted">
          <span class="fst-italic text-warning fw-semibold">Upload</span> all the required docs to unlock the next step—no sneaky skips
          allowed! Peek at the <span class="fst-italic text-warning fw-semibold">Review & Errors tabs</span> to make sure our AI nailed
          the details before you blast off to the form!
        </p>
      </div>
      <div class="col-lg-5">
        <div class="d-flex flex-wrap gap-3 p-3 bg-light rounded-pill shadow-sm">
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">location_on</span>
            <span class="text-muted">United Kingdom</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">phone_iphone</span>
            <span class="text-muted">Tourism</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">visibility</span>
            <span class="text-muted">2 days</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">calendar_today</span>
            <span class="text-muted">May 19, 2025 – May 21, 2025</span>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-4 py-4 mt-4 overflow-x-auto flex-nowrap">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill border-2 border-warning text-warning px-4 py-2 fw-medium bg-white shadow-sm">Details</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Guidelines</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Upload</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Review</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Submit</div>
      </div>
    </div>

    <div class="row g-4 mt-2">
      <div class="col-lg-4">
        <div class="border rounded p-4 overflow-auto" style="max-height: 70vh;" id="scrollable-documents">
          <h2 class="h4 fw-bold d-flex align-items-center mb-4">📑 Required Documents</h2>
          <ul class="list-unstyled" id="documents-list">
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="passport">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Passport</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="passport"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_funds">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Funds</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_funds"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="insurance">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Insurance</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="insurance"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_travel">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Travel</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_travel"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="letter">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Letter</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="letter"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_employment">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Employment</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_employment"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="photo">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Photo</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="photo"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="other">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Other</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="other"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="national_id">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>National ID</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="national_id"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_status">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Status</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_status"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_relationship">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Relationship</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_relationship"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_marital_status">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Marital Status</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_marital_status"></div>
              </div>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_address">
              <div class="w-100">
                <div class="d-flex justify-content-between align-items-center">
                  <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Address</label>
                  <span>(<span class="upload-count">0</span>/1)</span>
                </div>
                <div class="document-preview" data-doc-preview="proof_of_address"></div>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="card p-5 d-flex flex-column align-items-center justify-content-center text-center upload-section">
          <div id="upload-container" class="w-100" style="max-width: 28rem;">
            <div class="fs-1 text-muted mb-3">📄</div>
            <h3 class="h4 fw-semibold text-dark mb-2">Upload Your Documents</h3>
            <p class="text-muted small mb-4">Supported formats: PDF, JPG, PNG (Max 5MB each)</p>

            <form id="upload-form" class="mb-5">
              <label class="btn btn-warning text-white px-4 py-2 rounded-pill hover-scale">
                Select Documents
                <input type="file" id="file-input" class="d-none" multiple accept="image/*,.pdf">
              </label>
            </form>

            <div class="w-100 text-start">
              <h4 class="h6 fw-medium text-muted mb-3">Selected Documents</h4>
              <div id="selected-files" class="mb-4">
                <p class="text-muted small">No files selected</p>
              </div>
              
              <div class="d-flex justify-content-center">
                <button id="upload-button" class="btn btn-primary px-4 py-2 rounded-pill hover-scale" disabled>
                  Upload Documents
                </button>
              </div>
            </div>
          </div>

          <div id="upload-progress" class="d-none w-100 mt-4" style="max-width: 28rem;">
            <h4 class="h6 fw-medium text-muted mb-3">Uploading Documents</h4>
            <div id="upload-status"></div>
          </div>

          <div id="preview-section" class="preview-column w-100 d-none">
            <h4 class="h6 fw-medium text-muted mb-3">Document Previews</h4>
            <div id="preview-container" class="preview-container"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="custom-footer mt-5">
      <div class="footer-left">
        © Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div class="footer-right d-flex gap-2">
        <a href="indexA.html" class="btn btn-secondary">Go Back</a>
        <a href="reviewA.html" class="btn btn-primary">Start Application</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const fileInput = document.getElementById('file-input');
      const selectedFilesContainer = document.getElementById('selected-files');
      const uploadButton = document.getElementById('upload-button');
      const uploadForm = document.getElementById('upload-form');
      const uploadProgress = document.getElementById('upload-progress');
      const uploadStatus = document.getElementById('upload-status');
      const documentList = document.getElementById('documents-list');
      const previewSection = document.getElementById('preview-section');
      const previewContainer = document.getElementById('preview-container');

      const documentTypes = [
        'passport', 'proof_of_funds', 'insurance', 'proof_of_travel', 
        'letter', 'proof_of_employment', 'photo', 'other', 'national_id', 
        'proof_of_status', 'proof_of_relationship', 'proof_of_marital_status', 
        'proof_of_address'
      ];

      let filesToUpload = [];

      fileInput.addEventListener('change', function(e) {
        filesToUpload = Array.from(e.target.files).filter(file => {
          if (file.size > 5 * 1024 * 1024) {
            alert(`File ${file.name} exceeds 5MB limit and will not be uploaded`);
            return false;
          }
          return true;
        });
        renderSelectedFiles();
        renderPreviews();
        uploadButton.disabled = filesToUpload.length === 0;
        previewSection.classList.toggle('d-none', filesToUpload.length === 0);
      });

      function renderSelectedFiles() {
        selectedFilesContainer.innerHTML = '';
        if (filesToUpload.length === 0) {
          selectedFilesContainer.innerHTML = '<p class="text-muted small">No files selected</p>';
          return;
        }

        filesToUpload.forEach((file, index) => {
          const fileElement = document.createElement('div');
          fileElement.className = 'uploaded-file hover-scale mb-2';

          const fileInfo = document.createElement('div');
          fileInfo.className = 'file-info-container';

          const fileName = document.createElement('div');
          fileName.className = 'uploaded-file-name';
          fileName.textContent = file.name;

          const fileSize = document.createElement('div');
          fileSize.className = 'uploaded-file-size';
          fileSize.textContent = formatFileSize(file.size);

          fileInfo.appendChild(fileName);
          fileInfo.appendChild(fileSize);

          const fileTypeContainer = document.createElement('div');
          fileTypeContainer.className = 'file-select-container';

          const fileTypeSelect = document.createElement('select');
          fileTypeSelect.className = 'form-select form-select-sm';
          fileTypeSelect.required = true;
          fileTypeSelect.innerHTML = 
            `<option value="">Select document type</option>
            ${documentTypes.map(type => `<option value="${type}">${type.replace(/_/g, ' ')}</option>`).join('')}`;

          fileTypeContainer.appendChild(fileTypeSelect);

          const removeButton = document.createElement('span');
          removeButton.className = 'uploaded-file-remove material-icons small';
          removeButton.textContent = 'close';
          removeButton.onclick = () => {
            removeFile(index);
            renderPreviews();
            previewSection.classList.toggle('d-none', filesToUpload.length === 0);
          };

          fileElement.appendChild(fileInfo);
          fileElement.appendChild(fileTypeContainer);
          fileElement.appendChild(removeButton);
          selectedFilesContainer.appendChild(fileElement);
        });
      }

      function renderPreviews() {
        previewContainer.innerHTML = '';
        if (filesToUpload.length === 0) return;

        filesToUpload.forEach((file, index) => {
          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item hover-scale';

          if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.className = 'preview-image';
            img.alt = 'Preview';
            const reader = new FileReader();
            reader.onload = (e) => {
              img.src = e.target.result;
            };
            reader.readAsDataURL(file);
            previewItem.appendChild(img);
          } else {
            const pdfIcon = document.createElement('div');
            pdfIcon.className = 'preview-pdf';
            pdfIcon.innerHTML = '<span class="material-icons">picture_as_pdf</span>';
            previewItem.appendChild(pdfIcon);
          }

          const removeBtn = document.createElement('div');
          removeBtn.className = 'preview-remove';
          removeBtn.innerHTML = '<span class="material-icons" style="font-size: 14px;">close</span>';
          removeBtn.onclick = () => {
            removeFile(index);
            renderSelectedFiles();
            renderPreviews();
            previewSection.classList.toggle('d-none', filesToUpload.length === 0);
          };

          previewItem.appendChild(removeBtn);
          previewContainer.appendChild(previewItem);
        });
      }

      function removeFile(index) {
        filesToUpload.splice(index, 1);
        renderSelectedFiles();
        uploadButton.disabled = filesToUpload.length === 0;
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
      }

      uploadButton.addEventListener('click', async function() {
        const selects = selectedFilesContainer.querySelectorAll('select');
        let allSelected = true;
        
        selects.forEach(sel => {
          if (!sel.value) {
            sel.classList.add('is-invalid');
            allSelected = false;
          } else {
            sel.classList.remove('is-invalid');
          }
        });
        
        if (!allSelected) {
          alert('Please select document type for all files.');
          return;
        }

        document.body.classList.add('uploading');
        uploadForm.classList.add('d-none');
        uploadProgress.classList.remove('d-none');
        uploadStatus.innerHTML = '';
        uploadButton.disabled = true;
        
        await uploadFilesSequentially();
      });

      async function uploadFilesSequentially() {
        const MAX_RETRIES = 3;
        const DELAY = 1000;
        const failedUploads = [];
        let successfulUploads = 0;

        for (let i = 0; i < filesToUpload.length; i++) {
          const file = filesToUpload[i];
          const fileBlock = document.createElement('div');
          fileBlock.className = 'mb-3';
          fileBlock.innerHTML = 
            `<div class="d-flex justify-content-between small mb-1">
              <span>${file.name}</span>
              <span class="upload-percentage">Pending</span>
            </div>
            <div class="progress mb-1" style="height: 6px;">
              <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <div class="text-danger small error-message d-none"></div>`;
          uploadStatus.appendChild(fileBlock);

          const progressBar = fileBlock.querySelector('.progress-bar');
          const percentText = fileBlock.querySelector('.upload-percentage');
          const errorBox = fileBlock.querySelector('.error-message');
          let attempt = 0;
          let success = false;

          while (attempt <= MAX_RETRIES && !success) {
            try {
              await uploadSingleFile(file, progressBar, percentText);
              const docType = selectedFilesContainer.querySelectorAll('select')[i].value;
              updateDocumentStatus(docType, file);
              success = true;
              successfulUploads++;
            } catch (err) {
              attempt++;
              if (attempt > MAX_RETRIES) {
                percentText.textContent = 'Failed';
                progressBar.classList.remove('progress-bar');
                progressBar.classList.add('bg-danger');
                errorBox.classList.remove('d-none');
                errorBox.textContent = err.message || 'Upload failed';
                failedUploads.push(file);
              } else {
                percentText.textContent = `Retrying (${attempt}/${MAX_RETRIES})...`;
                await new Promise(r => setTimeout(r, DELAY));
              }
            }
          }
        }

        if (failedUploads.length === 0) {
          uploadStatus.innerHTML += 
            `<div class="alert alert-success mt-3">
              <span class="material-icons me-2">check_circle</span>
              All documents uploaded successfully!
            </div>
            <button id="continue-button" class="btn btn-success mt-2">Continue to Application</button>`;
          
          document.getElementById('continue-button').addEventListener('click', function() {
            window.location.href = 'reviewA.html';
          });
        } else {
          uploadStatus.innerHTML += 
            `<div class="alert alert-danger mt-3">
              ${failedUploads.length} file(s) failed to upload. Please try again.
            </div>`;
          uploadButton.disabled = false;
          uploadButton.textContent = 'Retry Failed Uploads';
        }

        // Reset form but keep previews
        filesToUpload = [];
        fileInput.value = '';
        renderSelectedFiles();
        previewSection.classList.add('d-none');
        document.body.classList.remove('uploading');
        uploadForm.classList.remove('d-none');
        uploadProgress.classList.add('d-none');
        uploadButton.disabled = false;
      }

      function uploadSingleFile(file, progressBar, percentText) {
        return new Promise((resolve, reject) => {
          const formData = new FormData();
          formData.append('images', file);
          formData.append('userId', 'user_1223');
          formData.append('applicantEmail', 'user@example.com');

          axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails', formData, {
            headers: { 'Content-Type': 'multipart/form-data' },
            onUploadProgress: (e) => {
              if (e.total) {
                const percent = Math.round((e.loaded * 100) / e.total);
                progressBar.style.width = percent + '%';
                percentText.textContent = percent + '%';
              }
            }
          }).then(res => {
            percentText.textContent = 'Uploaded';
            percentText.classList.add('text-success');
            progressBar.classList.add('bg-success');
            resolve(res.data);
          }).catch(err => {
            reject(new Error('Upload failed: ' + (err.response?.data?.message || err.message)));
          });
        });
      }

      function updateDocumentStatus(docType, file) {
        const el = document.querySelector(`.document-item[data-doc-type="${docType}"]`);
        if (el) {
          const countEl = el.querySelector('.upload-count');
          const count = parseInt(countEl.textContent);
          countEl.textContent = count + 1;
          el.querySelector('input').checked = true;
          el.classList.add('completed');

          // Add preview to left panel
          const previewContainer = el.querySelector('.document-preview');
          const previewItem = createDocumentPreview(file, docType);
          previewContainer.appendChild(previewItem);
        }
      }

      function createDocumentPreview(file, docType) {
        const previewItem = document.createElement('div');
        previewItem.className = 'document-preview-item hover-scale';
        
        if (file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.className = 'document-preview-image';
          const reader = new FileReader();
          reader.onload = (e) => img.src = e.target.result;
          reader.readAsDataURL(file);
          previewItem.appendChild(img);
        } else {
          previewItem.innerHTML = '<div class="document-preview-image bg-light d-flex align-items-center justify-content-center"><span class="material-icons">description</span></div>';
        }

        const removeBtn = document.createElement('div');
        removeBtn.className = 'document-preview-remove';
        removeBtn.innerHTML = '×';
        removeBtn.onclick = () => {
          // Remove from filesToUpload and update UI
          const index = filesToUpload.findIndex(f => f.name === file.name);
          if (index > -1) {
            filesToUpload.splice(index, 1);
            renderSelectedFiles();
            renderPreviews();
            updateDocumentCount(docType);
          }
          previewItem.remove();
        };

        previewItem.appendChild(removeBtn);
        return previewItem;
      }

      function updateDocumentCount(docType) {
        const el = document.querySelector(`.document-item[data-doc-type="${docType}"]`);
        if (el) {
          const countEl = el.querySelector('.upload-count');
          const currentCount = parseInt(countEl.textContent);
          countEl.textContent = Math.max(0, currentCount - 1);
          
          if (parseInt(countEl.textContent) === 0) {
            el.querySelector('input').checked = false;
            el.classList.remove('completed');
          }
        }
      }
    });
  </script>
</body>
</html>


 -->





 <!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
    }
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .btn-secondary, .btn-primary {
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    .btn-secondary { background-color: #6c757d; color: white; }
    .btn-primary { background-color: #0d6efd; color: white; }

    .document-item.completed { background-color: #f0fff0; }

    .uploaded-file {
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }

    .document-preview {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .document-preview-item {
      width: 50px;
      height: 50px;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      border: 1px solid #ddd;
    }

    .document-preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .upload-section {
      position: relative;
    }

    .preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 15px;
    }

    .preview-item {
      position: relative;
      width: 120px;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #dee2e6;
    }

    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(220, 53, 69, 0.8);
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .upload-status-indicator {
      position: absolute;
      bottom: 5px;
      left: 5px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 0.8rem;
    }

    #upload-form {
      transition: opacity 0.3s ease;
    }

    .uploading #upload-form {
      opacity: 0.5;
      pointer-events: none;
    }

    .doc-section-label {
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
  </style>
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
      <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
    </a>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row mb-4">
    <div class="col-lg-7">
      <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
      <p class="text-muted">
        <span class="fst-italic text-warning fw-semibold">Upload</span> your documents. AI will auto-categorize them. No manual selections needed.
      </p>
    </div>
  </div>

  <div class="row g-4">

    <div class="col-lg-4">
      <div class="border rounded p-4" id="scrollable-documents">
        <h5 class="fw-bold mb-3">📑 Required Documents</h5>
        <ul class="list-unstyled" id="documents-list">
        
          <li class="mb-3 document-item" data-doc-type="Certificate of Marriage">
            <div class="doc-section-label">
              <span><input type="checkbox" disabled class="me-2">Certificate of Marriage</span>
              <span>(<span class="upload-count">0</span>/1)</span>
            </div>
            <div class="document-preview" data-doc-preview="Certificate of Marriage"></div>
          </li>
         
        </ul>
      </div>
    </div>

    <div class="col-lg-8">
      <div class="card p-4 upload-section text-center">
        <form id="upload-form">
          <label class="btn btn-warning text-white rounded-pill">
            Select Documents
            <input type="file" id="file-input" class="d-none" multiple accept="image/*,.pdf">
          </label>
        </form>

        <div id="selected-files" class="mt-3 text-muted small">No files selected</div>

        <div class="mt-3">
          <button id="upload-button" class="btn btn-primary rounded-pill" disabled>Upload Documents</button>
        </div>

        <div id="preview-section" class="preview-column mt-4 d-none">
          <h6 class="text-muted mb-2">Document Previews</h6>
          <div id="preview-container" class="preview-container"></div>
        </div>

        <div id="upload-progress" class="d-none mt-4">
          <h6 class="text-muted mb-2">Uploading...</h6>
          <div id="upload-status"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const fileInput = document.getElementById('file-input');
  const uploadButton = document.getElementById('upload-button');
  const selectedFilesContainer = document.getElementById('selected-files');
  const uploadForm = document.getElementById('upload-form');
  const uploadStatus = document.getElementById('upload-status');
  const uploadProgress = document.getElementById('upload-progress');
  const previewContainer = document.getElementById('preview-container');
  const previewSection = document.getElementById('preview-section');

  let filesToUpload = [];

  fileInput.addEventListener('change', (e) => {
    filesToUpload = Array.from(e.target.files).filter(file => {
      if (file.size > 5 * 1024 * 1024) {
        alert(`File ${file.name} exceeds 5MB limit`);
        return false;
      }
      return true;
    });
    renderFileList();
    renderPreviews();
    uploadButton.disabled = filesToUpload.length === 0;
    previewSection.classList.toggle('d-none', filesToUpload.length === 0);
  });

  function renderFileList() {
    selectedFilesContainer.innerHTML = '';
    if (filesToUpload.length === 0) {
      selectedFilesContainer.textContent = 'No files selected';
      return;
    }
    filesToUpload.forEach(file => {
      const div = document.createElement('div');
      div.textContent = file.name;
      div.className = 'uploaded-file';
      selectedFilesContainer.appendChild(div);
    });
  }

  function renderPreviews() {
    previewContainer.innerHTML = '';
    filesToUpload.forEach(file => {
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.className = 'preview-image';
        const reader = new FileReader();
        reader.onload = (e) => img.src = e.target.result;
        reader.readAsDataURL(file);
        previewItem.appendChild(img);
      } else {
        previewItem.innerHTML = '<div class="preview-image bg-light d-flex align-items-center justify-content-center"><span class="material-icons">picture_as_pdf</span></div>';
      }

      previewContainer.appendChild(previewItem);
    });
  }

  uploadButton.addEventListener('click', async () => {
    uploadForm.classList.add('d-none');
    uploadProgress.classList.remove('d-none');
    uploadStatus.innerHTML = '';
    uploadButton.disabled = true;

    for (const file of filesToUpload) {
      await uploadFile(file);
    }

    uploadForm.classList.remove('d-none');
    previewSection.classList.add('d-none');
    fileInput.value = '';
    filesToUpload = [];
    renderFileList();
    uploadButton.disabled = false;
  });

  async function uploadFile(file) {
    const formData = new FormData();
    formData.append('images', file);
    formData.append('userId', 'user_1223');
    formData.append('applicantEmail', 'user@example.com');

    const statusBlock = document.createElement('div');
    statusBlock.textContent = `Uploading ${file.name}...`;
    uploadStatus.appendChild(statusBlock);

    try {
      const response = await axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails', formData, {
        headers: { 'Content-Type': 'multipart/form-data' }
      });

      const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
      const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;

      if (docType && imageUrl) {
        addPreviewToDocumentList(docType, imageUrl);
        statusBlock.innerHTML = `<span class="text-success">${file.name} uploaded and categorized as <strong>${docType}</strong></span>`;
      } else {
        statusBlock.innerHTML = `<span class="text-warning">${file.name} uploaded but could not detect document type.</span>`;
      }
    } catch (error) {
      statusBlock.innerHTML = `<span class="text-danger">Failed to upload ${file.name}</span>`;
    }
  }

  function addPreviewToDocumentList(docType, imageUrl) {
    let docItem = document.querySelector(`.document-item[data-doc-type="${docType}"]`);
    if (!docItem) {
     
      const ul = document.getElementById('documents-list');
      const li = document.createElement('li');
      li.className = 'mb-3 document-item completed';
      li.setAttribute('data-doc-type', docType);

      li.innerHTML = `
        <div class="doc-section-label">
          <span><input type="checkbox" disabled class="me-2" checked>${docType}</span>
          <span>(<span class="upload-count">1</span>/1)</span>
        </div>
        <div class="document-preview" data-doc-preview="${docType}"></div>
      `;
      ul.appendChild(li);
      docItem = li;
    }

    const previewContainer = docItem.querySelector('.document-preview');
    const imgDiv = document.createElement('div');
    imgDiv.className = 'document-preview-item';

    const img = document.createElement('img');
    img.src = imageUrl;
    img.className = 'document-preview-image';
    imgDiv.appendChild(img);
    previewContainer.appendChild(imgDiv);

    const countEl = docItem.querySelector('.upload-count');
    countEl.textContent = parseInt(countEl.textContent) + 1;
    docItem.classList.add('completed');
    docItem.querySelector('input').checked = true;
  }
});
</script>


<div class="custom-footer mt-5">
  <div class="footer-left">
    © Nuron.AI Corp. | Powered by Intellivisa
  </div>
  <div class="footer-right d-flex gap-2">
    <a href="indexA.html" class="btn btn-secondary">Go Back</a>
    <a href="reviewA.html" class="btn btn-primary">Start Application</a>
  </div>
</div>

</body>
</html>   -->


  






  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
   <script>
    // Add 'Unsorted' as first type for unknown types
    const DOC_TYPES = [
      "Unsorted",
      "Passport", "Passport front", "Passport back", "Passport stamp page", "Passport blank page", "Visa page", "Photo",
      "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary", "Business Balance Sheet",
      "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip", "Employment Letter",
      "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket", "Letter", "Proof of Employment"
    ];
    let uploadedImages = []; // {docType,fileName,imageUrl,backendObj}
    let selectedDocTypeIdx = 0, selectedFileIdx = 0;

    function renderChecklist(){
      const ctn = document.getElementById('doc-checklist');
      ctn.innerHTML = '';
      DOC_TYPES.forEach((docType,dtIdx)=>{
        const files = uploadedImages.filter(x=>x.docType===docType);
        const main = document.createElement('div');
        main.className = "doc-type-row";
        main.innerHTML = `
          <div class="doc-type-main${dtIdx===selectedDocTypeIdx?' selected':''}" data-idx="${dtIdx}">
            <input class="doc-type-checkbox" type="checkbox" disabled ${files.length>0?'checked':''}>
            <span>${docType}</span>
            <span class="doc-type-count">(${files.length}/1) Selected</span>
          </div>
          <div class="doc-type-files"></div>`;
        const filesDiv = main.querySelector('.doc-type-files');
        files.forEach((obj,i)=>{
          const fileDiv = document.createElement('div');
          fileDiv.className = 'doc-type-file'+((dtIdx===selectedDocTypeIdx && i===selectedFileIdx)?' selected':'');
          fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName||obj.imageUrl||'Doc')}</span>`;
          fileDiv.onclick=()=>{
            selectDocFile(dtIdx, i);
          };
          filesDiv.appendChild(fileDiv);
        });
        main.querySelector('.doc-type-main').onclick=()=>{
          if(files.length) selectDocFile(dtIdx,0);
        }
        ctn.appendChild(main);
      });
    }
    
    function truncateFilename(name, maxLen=22){
      if(name.length<=maxLen)return name;
      return name.slice(0,maxLen-4)+'...'+name.split('.').pop();
    }
    
    function updateMainPreview(){
      const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
      if(!docsOfType.length){ setUIState('empty'); return; }
      setUIState('preview');
      const sel = document.getElementById('doc-type-dropdown');
      sel.innerHTML = DOC_TYPES.map((type,i)=>
        `<option value="${i}">${type}</option>`).join('');
      // Set value to the ACTUAL doc type of the current file
      const curr = docsOfType[selectedFileIdx];
      sel.value = DOC_TYPES.indexOf(curr.docType);
      sel.onchange = function(){
        // Move current file to the new doc type
        const newDocType = DOC_TYPES[Number(sel.value)];
        curr.docType = newDocType;
        // Update indices to show the last file of the new type
        selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
        selectedFileIdx = uploadedImages.filter(x=>x.docType===newDocType).length-1;
        renderChecklist(); updateMainPreview();
      }
      document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
      document.getElementById('preview-img-main').src = curr.imageUrl;
      document.getElementById('preview-img-main').style.display = '';
      const thumbRow = document.getElementById('perdoc-thumb-carousel');
      thumbRow.innerHTML = '';
      docsOfType.forEach((obj,idx)=>{
        const thumb = document.createElement('img');
        thumb.src = obj.imageUrl;
        thumb.className = 'doc-thumb-carousel-img'+(idx===selectedFileIdx?' selected':'');
        thumb.onclick=()=>selectDocFile(selectedDocTypeIdx, idx);
        thumbRow.appendChild(thumb);
      });
      renderRightDetails();
      renderChecklist();
    }
    
    function selectDocFile(dtIdx, fileIdx){
      selectedDocTypeIdx=dtIdx;selectedFileIdx=fileIdx;updateMainPreview();
    }

    function renderRightDetails(){
      const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
      const curr = docsOfType[selectedFileIdx];
      const form = document.getElementById('right-details-fields');
      let reviewCount=0, errorCount=0;
      form.innerHTML='';
      if(curr){
        const details = curr.backendObj?.parsedData?.['Extracted Details']||{};
        for(const [k,v] of Object.entries(details)){
          const vv = (v!==null&&v!==undefined&&v!=='null')?v:'';
          if(vv)reviewCount++;else errorCount++;
          form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
          <input type="text" readonly value="${vv}"/></div>`;
        }
      }
      document.getElementById('review-details-count').innerText= reviewCount;
      document.getElementById('review-errors-count').innerText= errorCount;
    }
    
    function setUIState(state, filename) {
      document.getElementById('empty-upload-card').style.display = (state==='empty')?'':'none';
      document.getElementById('uploading-indicator').style.display = (state==='uploading')?'':'none';
      document.getElementById('doc-preview-full').style.display = (state==='preview')?'':'none';
      if(state==='uploading') {
        document.getElementById('uploading-file-name').textContent = filename||'';
      }
    }
    
    function handleFilesSelected(fileInputs) {
      if(!fileInputs.length) return;
      let idx=0;
      function uploadNext() {
        if(idx>=fileInputs.length){
          if(uploadedImages.length){
            const lastUp = uploadedImages[uploadedImages.length-1];
            selectedDocTypeIdx = DOC_TYPES.indexOf(lastUp.docType);
            const files = uploadedImages.filter(x=>x.docType===lastUp.docType);
            selectedFileIdx = files.length-1;
            setUIState("preview"); updateMainPreview();
          }else setUIState('empty');
          renderChecklist();
          return;
        }
        setUIState('uploading', fileInputs[idx].name);
        uploadFileWithRetry(fileInputs[idx],0)
          .then(({docType,imageUrl,backendObj})=>{
            // Map backend doc type to DOC_TYPES; fallback to "Unsorted" if not found or empty
            let assignedDocType = (
              docType &&
              DOC_TYPES.map(x=>x.toLowerCase()).includes(docType.trim().toLowerCase())
            ) ? DOC_TYPES.find(x => x.toLowerCase()===docType.trim().toLowerCase())
              : DOC_TYPES[0]; // "Unsorted"
            uploadedImages.push({docType: assignedDocType, fileName:fileInputs[idx].name, imageUrl, backendObj});
            idx++; renderChecklist(); uploadNext();
          })
          .catch(()=>{
            idx++; uploadNext();
          });
      }
      uploadNext();
    }
    
    function uploadFileWithRetry(file,attempt) {
      return uploadFile(file).catch(e=>attempt<2?uploadFileWithRetry(file,attempt+1):Promise.reject(e));
    }
    
    async function uploadFile(file) {
      const formData = new FormData();
      formData.append('images', file);
      formData.append('userId', 'user_1223');
      formData.append('applicantEmail', 'user@example.com');
      const response = await axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
        formData, {headers:{'Content-Type':'multipart/form-data'}});
      const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
      const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
      const backendObj = response.data?.imageeDetails?.[0];
      return {docType, imageUrl, backendObj};
    }

    document.getElementById('main-upload-btn').onclick = ()=>{
      document.getElementById('main-file-input').value='';
      document.getElementById('main-file-input').click();
    };
    document.getElementById('main-file-input').onchange = function(e){
      if(e.target.files) handleFilesSelected(e.target.files);
    };

    setUIState('empty');
    renderChecklist();
  </script>  -->



 <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
  "Visa page", "Photo", "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary",
  "Business Balance Sheet", "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip",
  "Employment Letter", "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket",
  "Letter", "Proof of Employment", "Certificate of Marriage",
  "Aadhaar card", "Income Tax Return Acknowledgement", "GST Document", "Emigration Check Required Document",
  "Passbook", "Bank Statement"
];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function matchDocType(docTypeRaw) {
  if (!docTypeRaw) return "Unsorted";
  return DOC_TYPES.find(t => t.toLowerCase() === docTypeRaw.trim().toLowerCase()) || "Unsorted";
}

function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}

function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  if (curr) {
    const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
    for (const [k, v] of Object.entries(details)) {
      const vv = (v !== null && v !== undefined && v !== 'null') ? v : '';
      if (vv) reviewCount++; else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
        <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}

function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';
  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}

async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  let idx = 0;

  function next() {
    if (idx >= fileInputs.length) {
      renderChecklist();
      return;
    }

    const file = fileInputs[idx];
    setUIState('uploading', file.name);

    uploadFile(file).then(({ docType, imageUrl, backendObj }) => {
      const assignedDocType = matchDocType(docType);
      uploadedImages.push({ docType: assignedDocType, fileName: file.name, imageUrl, backendObj });
      idx++;
      updateMainPreview();
      renderChecklist();
      next();
    }).catch(() => {
      idx++;
      next();
    });
  }

  next();
}

async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');
  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );
  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];
  return { docType, imageUrl, backendObj };
}

document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script>  -->




<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", "Passport front", "Passport back", "Passport stamp page", "Passport blank page",
  "Visa page", "Photo", "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary",
  "Business Balance Sheet", "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip",
  "Employment Letter", "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket",
  "Letter", "Proof of Employment", "Certificate of Marriage",
  "Aadhaar card", "Income Tax Return Acknowledgement", "GST Document",
  "Emigration Check Required Document", "Passbook", "Bank Statement"
];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function matchDocType(docTypeRaw) {
  if (!docTypeRaw) return "Unsorted";
  return DOC_TYPES.find(t => t.toLowerCase() === docTypeRaw.trim().toLowerCase()) || "Unsorted";
}

function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}

function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  if (curr) {
    const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
    for (const [k, v] of Object.entries(details)) {
      const vv = (v !== null && v !== undefined && v !== 'null') ? v : '';
      if (vv) reviewCount++; else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
        <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}

function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';
  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}

// ✅ Handles each file with retry logic
async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  let idx = 0;

  async function next() {
    if (idx >= fileInputs.length) {
      renderChecklist();
      return;
    }

    const file = fileInputs[idx];
    setUIState('uploading', file.name);

    try {
      const { docType, imageUrl, backendObj } = await uploadFileWithRetry(file, 0);
      const assignedDocType = matchDocType(docType);
      uploadedImages.push({ docType: assignedDocType, fileName: file.name, imageUrl, backendObj });
    } catch (e) {
      console.warn("Upload failed after 3 attempts:", file.name);
    }

    idx++;
    updateMainPreview();
    renderChecklist();
    next();
  }

  next();
}

// 🔁 Retry up to 3 times on error
async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}

// 📤 Upload to backend
async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}

document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script> -->



<!-- 
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", "Passport front", "Passport back", "Passport stamp page", "Passport blank page",
  "Visa page", "Photo", "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary",
  "Business Balance Sheet", "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip",
  "Employment Letter", "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket",
  "Letter", "Proof of Employment", "Certificate of Marriage",
  "Aadhaar card", "Income Tax Return Acknowledgement", "GST Document",
  "Emigration Check Required Document", "Passbook", "Bank Statement"
];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function matchDocType(docTypeRaw) {
  if (!docTypeRaw) return "Unsorted";
  return DOC_TYPES.find(t => t.toLowerCase() === docTypeRaw.trim().toLowerCase()) || "Unsorted";
}

function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}

function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  if (curr) {
    const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
    for (const [k, v] of Object.entries(details)) {
      const vv = (v !== null && v !== undefined && v !== 'null') ? v : '';
      if (vv) reviewCount++; else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
        <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}

function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';
  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}

// ✅ Robust upload with retries and async batch support
async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  setUIState('uploading');

  for (let file of fileInputs) {
    document.getElementById('uploading-file-name').textContent = file.name;

    try {
      const { docType, imageUrl, backendObj } = await uploadFileWithRetry(file, 0);
      const assignedDocType = matchDocType(docType);
      uploadedImages.push({ docType: assignedDocType, fileName: file.name, imageUrl, backendObj });
    } catch (e) {
      console.warn(`❌ Upload failed after 3 attempts: ${file.name}`);
    }

    updateMainPreview();
    renderChecklist();
  }

  setUIState(uploadedImages.length ? 'preview' : 'empty');
}

// 🔁 Retry 3 times max
async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}

// 📤 Actual backend upload
async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}

document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script> -->










































<!-- 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Upload with Details Preview</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
    }
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .btn-secondary, .btn-primary {
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    .btn-secondary { background-color: #6c757d; color: white; }
    .btn-primary { background-color: #0d6efd; color: white; }
    .document-item.completed { background-color: #f0fff0; }
    .uploaded-file {
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .document-preview {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .document-preview-item {
      width: 50px; height: 50px;
      border-radius: 6px;
      overflow: hidden;
      border: 1.5px solid #ddd;
      position: relative;
      background: #f8fafc;
      cursor: pointer;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .document-preview-item.selected {
      box-shadow: 0 0 0 3px #f9731677;
      border: 2.2px solid #f97316;
      z-index: 1;
    }
    .document-preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .preview-container {
      display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;
    }
    .preview-item {
      position: relative;
      width: 120px; height: 120px;
      border-radius: 8px; overflow: hidden;
      border: 1px solid #dee2e6;
    }
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .doc-section-label {
      font-weight: 600;
      display: flex; align-items: center; justify-content: space-between;
    }
    /* --- Preview/details panel --- */
    #doc-preview-details-row {
      margin-top: 36px;
      padding-top: 4px;
      background: linear-gradient(120deg,#fdf1ed 0,#fdeffb 60%,#e1eaff 100%);
      border-radius: 14px;
      min-height: 420px;
      box-shadow: 0 3px 20px #f1dbfd6e;
    }
    #selected-doc-image-box img {
      max-height: 370px; max-width: 96%; border-radius: 12px; box-shadow:0 2px 16px #eabfff22
    }
    #selected-doc-image-box { background:#fff; }
    #selected-doc-details > .col-md-6 {
      padding-bottom: .7rem;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
      <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
    </a>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row mb-4">
    <div class="col-lg-7">
      <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
      <p class="text-muted">
        <span class="fst-italic text-warning fw-semibold">Upload</span> your documents. AI will auto-categorize them. No manual selections needed.
      </p>
    </div>
  </div>
  <div class="row g-4">

    <div class="col-lg-4">
      <div class="border rounded p-4" id="scrollable-documents">
        <h5 class="fw-bold mb-3">📑 Required Documents</h5>
        <ul class="list-unstyled" id="documents-list">
          <li class="mb-3 document-item" data-doc-type="Certificate of Marriage">
            <div class="doc-section-label">
              <span><input type="checkbox" disabled class="me-2">Certificate of Marriage</span>
              <span>(<span class="upload-count">0</span>/1)</span>
            </div>
            <div class="document-preview" data-doc-preview="Certificate of Marriage"></div>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="col-lg-8">
      <div class="card p-4 upload-section text-center">
        <form id="upload-form">
          <label class="btn btn-warning text-white rounded-pill">
            Select Documents
            <input type="file" id="file-input" class="d-none" multiple accept="image/*,.pdf">
          </label>
        </form>
        <div id="selected-files" class="mt-3 text-muted small">No files selected</div>
        <div class="mt-3">
          <button id="upload-button" class="btn btn-primary rounded-pill" disabled>Upload Documents</button>
        </div>
        <div id="preview-section" class="preview-column mt-4 d-none">
          <h6 class="text-muted mb-2">Document Previews</h6>
          <div id="preview-container" class="preview-container"></div>
        </div>
        <div id="upload-progress" class="d-none mt-4">
          <h6 class="text-muted mb-2">Uploading...</h6>
          <div id="upload-status"></div>
        </div>
      </div>
   
      <div id="doc-preview-details-row" class="row mt-4 d-none">
        <div class="col-lg-12 d-flex gap-4">
          <div style="max-width:320px;min-width:200px;flex:1;">
            <div id="selected-doc-image-box" class="border rounded shadow text-center p-3 bg-white" style="height:400px;display:flex;align-items:center;justify-content:center;">
          
            </div>
          </div>
          <div style="flex:2;">
            <div class="card bg-white p-3">
              <h6 class="fw-bold">Extracted Details</h6>
              <div id="selected-doc-details" class="row g-2">
                
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  // --- Upload logic variables ---
  const fileInput = document.getElementById('file-input');
  const uploadButton = document.getElementById('upload-button');
  const selectedFilesContainer = document.getElementById('selected-files');
  const uploadForm = document.getElementById('upload-form');
  const uploadStatus = document.getElementById('upload-status');
  const uploadProgress = document.getElementById('upload-progress');
  const previewContainer = document.getElementById('preview-container');
  const previewSection = document.getElementById('preview-section');
  let filesToUpload = [];
  // NEW: store all uploaded images' info (for preview/details)
  const uploadedImagesState = []; // { docType, imageUrl, backendObj, li, imgDiv }

  // --- Preview/detail right-panel elements ---
  const docPreviewDetailsRow = document.getElementById('doc-preview-details-row');
  const selectedDocImageBox = document.getElementById('selected-doc-image-box');
  const selectedDocDetails = document.getElementById('selected-doc-details');

  fileInput.addEventListener('change', (e) => {
    filesToUpload = Array.from(e.target.files).filter(file => {
      if (file.size > 5 * 1024 * 1024) {
        alert(`File ${file.name} exceeds 5MB limit`);
        return false;
      }
      return true;
    });
    renderFileList();
    renderPreviews();
    uploadButton.disabled = filesToUpload.length === 0;
    previewSection.classList.toggle('d-none', filesToUpload.length === 0);
  });

  function renderFileList() {
    selectedFilesContainer.innerHTML = '';
    if (filesToUpload.length === 0) {
      selectedFilesContainer.textContent = 'No files selected';
      return;
    }
    filesToUpload.forEach(file => {
      const div = document.createElement('div');
      div.textContent = file.name;
      div.className = 'uploaded-file';
      selectedFilesContainer.appendChild(div);
    });
  }

  function renderPreviews() {
    previewContainer.innerHTML = '';
    filesToUpload.forEach(file => {
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.className = 'preview-image';
        const reader = new FileReader();
        reader.onload = (e) => img.src = e.target.result;
        reader.readAsDataURL(file);
        previewItem.appendChild(img);
      } else {
        previewItem.innerHTML = '<div class="preview-image bg-light d-flex align-items-center justify-content-center"><span class="material-icons">picture_as_pdf</span></div>';
      }

      previewContainer.appendChild(previewItem);
    });
  }

  uploadButton.addEventListener('click', async () => {
    uploadForm.classList.add('d-none');
    uploadProgress.classList.remove('d-none');
    uploadStatus.innerHTML = '';
    uploadButton.disabled = true;

    for (const file of filesToUpload) {
      await uploadFile(file);
    }

    uploadForm.classList.remove('d-none');
    previewSection.classList.add('d-none');
    fileInput.value = '';
    filesToUpload = [];
    renderFileList();
    uploadButton.disabled = false;
  });

  async function uploadFile(file) {
    const formData = new FormData();
    formData.append('images', file);
    formData.append('userId', 'user_1223');
    formData.append('applicantEmail', 'user@example.com');
    const statusBlock = document.createElement('div');
    statusBlock.textContent = `Uploading ${file.name}...`;
    uploadStatus.appendChild(statusBlock);

    try {
      const response = await axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails', formData, {
        headers: { 'Content-Type': 'multipart/form-data' }
      });
      const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
      const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
      if (docType && imageUrl) {
        addPreviewToDocumentList(docType, imageUrl, response.data.imageeDetails[0]);
        statusBlock.innerHTML = `<span class="text-success">${file.name} uploaded and categorized as <strong>${docType}</strong></span>`;
      } else {
        statusBlock.innerHTML = `<span class="text-warning">${file.name} uploaded but could not detect document type.</span>`;
      }
    } catch (error) {
      statusBlock.innerHTML = `<span class="text-danger">Failed to upload ${file.name}</span>`;
    }
  }

  // NEW: Details/Preview logic
  function showDocPreviewAndDetails(backendObj, imageUrl, docType, sourceImgDiv) {
    docPreviewDetailsRow.classList.remove('d-none');
    selectedDocImageBox.innerHTML = `<img src="${imageUrl}" alt="Preview">`;
    selectedDocDetails.innerHTML = '';
    if (docType) {
      selectedDocDetails.innerHTML += `
        <div class='col-md-6'><div class='fw-semibold'>Document Type</div>
        <div class='text-muted small'>${docType}</div></div>`;
    }
    const extractDetails = backendObj?.parsedData?.["Extracted Details"] || {};
    Object.entries(extractDetails).forEach(([k, v]) => {
      if(v!==null && v!=='null' && v!==undefined && v!=='') {
        selectedDocDetails.innerHTML += `
          <div class='col-md-6'><div class='fw-semibold'>${k}</div>
          <div class='text-muted small'>${v}</div></div>`;
      }
    });
    document.querySelectorAll('.document-preview-item.selected').forEach(e=>e.classList.remove('selected'));
    if (sourceImgDiv) sourceImgDiv.classList.add('selected');
  }

  function addPreviewToDocumentList(docType, imageUrl, backendObj) {
    let docItem = document.querySelector(`.document-item[data-doc-type="${docType}"]`);
    if (!docItem) {
      const ul = document.getElementById('documents-list');
      const li = document.createElement('li');
      li.className = 'mb-3 document-item completed';
      li.setAttribute('data-doc-type', docType);
      li.innerHTML = `
        <div class="doc-section-label">
          <span><input type="checkbox" disabled class="me-2" checked>${docType}</span>
          <span>(<span class="upload-count">1</span>/1)</span>
        </div>
        <div class="document-preview" data-doc-preview="${docType}"></div>
      `;
      ul.appendChild(li);
      docItem = li;
    }
    const previewContainer = docItem.querySelector('.document-preview');
    const imgDiv = document.createElement('div');
    imgDiv.className = 'document-preview-item';
    const img = document.createElement('img');
    img.src = imageUrl;
    img.className = 'document-preview-image';
    imgDiv.appendChild(img);
    previewContainer.appendChild(imgDiv);
    uploadedImagesState.push({ docType, imageUrl, backendObj, li:docItem, imgDiv });
    imgDiv.addEventListener('click', function() {
      showDocPreviewAndDetails(backendObj, imageUrl, docType, imgDiv);
    });
    // Auto-select first if it's the only
    if (uploadedImagesState.length === 1) {
      showDocPreviewAndDetails(backendObj, imageUrl, docType, imgDiv);
    }
    const countEl = docItem.querySelector('.upload-count');
    countEl.textContent = parseInt(countEl.textContent) + 1;
    docItem.classList.add('completed');
    docItem.querySelector('input').checked = true;
  }
});
</script>

<div class="custom-footer mt-5">
  <div class="footer-left">
    © Nuron.AI Corp. | Powered by Intellivisa
  </div>
  <div class="footer-right d-flex gap-2">
    <a href="indexA.html" class="btn btn-secondary">Go Back</a>
    <a href="reviewA.html" class="btn btn-primary">Start Application</a>
  </div>
</div>

</body>
</html> -->



























































































  <!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doc Upload UI - Accurate Reference</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      border-right: 1.5px solid #f6dbfc;
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;
    }
    .checklist-box {
      background: #fff; border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    /* Center */
    .center-panel { flex:1; height:100vh; overflow-y:auto; min-width:0; display:flex; flex-direction:column;justify-content:center;align-items:center;}
    .upload-empty-card { margin:auto; margin-top:100px; max-width:444px; width:100%; background:rgba(255,255,255,0.97); border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px; border:none; border-radius:99px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    /* Uploading UI */
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    /* Main Preview */
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      background:#fff;box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img { max-width:170px; max-height:265px;border-radius:7px;object-fit:contain; margin:0 auto 2px;}
    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    /* Right panel is same as previous answer, omitted for brevity */
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }
  </style>
</head>
<body>
<div class="doc-app-container">
  
  <aside class="left-panel">
    <div class="checklist-box">
      <div class="checklist-title">
        <span class="mdi mdi-lock-document-outline"></span> Upload Documents
      </div>
      <div id="doc-checklist"></div>
    </div>
  </aside>

  <main class="center-panel">
    <div id="empty-upload-card" class="upload-empty-card">
      <span class="mdi mdi-file-remove-outline"></span>
      <h4>No Documents Uploaded</h4>
      <p>Start by uploading your documents here<br>to proceed with your application.</p>
      <button class="upload-btn" id="main-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
      <input type="file" id="main-file-input" style="display:none" accept="image/*,.pdf" multiple />
    </div>
    <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
      <div class="lds-dual-ring"></div>
      <div class="uploading-meta">Uploading your document…</div>
      <div class="uploading-file-name" id="uploading-file-name"></div>
    </div>
    <div id="doc-preview-full" style="display:none;width:100%;">
      <div class="doc-toolbar mb-1">
        <span class="doc-type-icon mdi mdi-file-document-outline"></span>
        <select id="doc-type-dropdown"></select>
        <span class="mdi mdi-chevron-right"></span>
        <span class="doc-file-id-box" id="doc-file-id-box"><span id="preview-file-name"></span><span class='mdi mdi-checkbox-marked-circle-outline'></span></span>
        <span class="doc-toolbar-btns d-flex flex-column">
          <button class="doc-toolbar-btn" title="Settings"><span class="mdi mdi-tune-variant"></span></button>
          <button class="doc-toolbar-btn" title="Zoom In"><span class="mdi mdi-magnify-plus-outline"></span></button>
          <button class="doc-toolbar-btn" title="Zoom"><span class="mdi mdi-magnify"></span></button>
        </span>
      </div>
      <div class="large-doc-preview-card">
        <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
      </div>
      <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
    </div>
  </main>
  
  <aside class="right-panel d-flex flex-column">
    <div class="review-header-row">
      <span class="review-bar">
        <span class="mdi mdi-clipboard-check-outline"></span>
        Review Details
        <span class="count-bubble" id="review-details-count">0</span>
      </span>
      <span class="review-bar" style="background:#fff5f4; color:#ec3636; border-color:#fce1e1;">
        Errors <span class="count-bubble" id="review-errors-count">0</span>
      </span>
    </div>
    <button class="save-edited-btn"><span class="mdi mdi-content-save-outline"></span> Save Edited Data</button>
    <form class="right-details-fields" id="right-details-fields"></form>
  </aside>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Passport", "Passport front", "Passport back", "Passport stamp page", "Passport blank page", "Visa page", "Photo",
  "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary", "Business Balance Sheet",
  "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip", "Employment Letter",
  "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket", "Letter", "Proof of Employment"
];
let uploadedImages = []; // {docType,fileName,imageUrl,backendObj}
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function renderChecklist(){
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType,dtIdx)=>{
    const files = uploadedImages.filter(x=>x.docType===docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `<div class="doc-type-main${dtIdx===selectedDocTypeIdx?' selected':''}" data-idx="${dtIdx}">
      <input class="doc-type-checkbox" type="checkbox" disabled ${files.length>0?'checked':''}>
      <span>${docType}</span>
      <span class="doc-type-count">(${files.length}/1) Selected</span>
    </div>
    <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj,i)=>{
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file'+((dtIdx===selectedDocTypeIdx && i===selectedFileIdx)?' selected':'');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName||obj.imageUrl||'Doc')}</span>`;
      fileDiv.onclick=()=>{
        selectDocFile(dtIdx, i);
      };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick=()=>{
      if(files.length) selectDocFile(dtIdx,0);
    }
    ctn.appendChild(main);
  });
}
function truncateFilename(name, maxLen=22){
  if(name.length<=maxLen)return name;
  return name.slice(0,maxLen-4)+'...'+name.split('.').pop();
}
function updateMainPreview(){
  const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
  if(!docsOfType.length){ setUIState('empty'); return; }
  setUIState('preview');
  // -- Doc type drop-down (all doc types list)
  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type,i)=>`<option value="${i}">${type}</option>`).join('');
  sel.value = selectedDocTypeIdx;
  sel.onchange = function(){
    // Upon changing the doc type on preview, reassign THIS file with that type!
    const oldTypeIdx = selectedDocTypeIdx, fileIdx = selectedFileIdx;
    uploadedImages
      .filter(x=>x.docType===DOC_TYPES[oldTypeIdx])[fileIdx]
      .docType = DOC_TYPES[Number(sel.value)];
    // Move to that doc type and select this same file (now moved)
    selectedDocTypeIdx = Number(sel.value);
    selectedFileIdx = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]).length-1;
    renderChecklist(); updateMainPreview();
  }
  // -- File name
  const curr = docsOfType[selectedFileIdx];
  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  // -- Main image preview
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';
  // -- File thumbs
  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj,idx)=>{
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img'+(idx===selectedFileIdx?' selected':'');
    thumb.onclick=()=>selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });
  renderRightDetails();
  renderChecklist();
}
function selectDocFile(dtIdx, fileIdx){
  selectedDocTypeIdx=dtIdx;selectedFileIdx=fileIdx;updateMainPreview();
}

// --------- Right panel details
function renderRightDetails(){
  const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount=0, errorCount=0;
  form.innerHTML='';
  if(curr){
    const details = curr.backendObj?.parsedData?.['Extracted Details']||{};
    for(const [k,v] of Object.entries(details)){
      const vv = (v!==null&&v!==undefined&&v!=='null')?v:'';
      if(vv)reviewCount++;else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
      <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText= reviewCount;
  document.getElementById('review-errors-count').innerText= errorCount;
}
// --------- Upload / state mgmt
function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state==='empty')?'':'none';
  document.getElementById('uploading-indicator').style.display = (state==='uploading')?'':'none';
  document.getElementById('doc-preview-full').style.display = (state==='preview')?'':'none';
  if(state==='uploading') {
    document.getElementById('uploading-file-name').textContent = filename||'';
  }
}
function handleFilesSelected(fileInputs) {
  if(!fileInputs.length) return;
  let idx=0;
  function uploadNext() {
    if(idx>=fileInputs.length){
      if(uploadedImages.length){
        const {docType} = uploadedImages[uploadedImages.length-1];
        selectedDocTypeIdx = DOC_TYPES.indexOf(docType);
        const files = uploadedImages.filter(x=>x.docType===docType);
        selectedFileIdx = files.length-1;
        setUIState("preview"); updateMainPreview();
      }else setUIState('empty');
      renderChecklist();
      return;
    }
    setUIState('uploading', fileInputs[idx].name);
    uploadFileWithRetry(fileInputs[idx],0)
      .then(({docType,imageUrl,backendObj})=>{
        let assignedDocType = docType && DOC_TYPES.includes(docType) ? docType : DOC_TYPES[0];
        uploadedImages.push({docType: assignedDocType, fileName:fileInputs[idx].name, imageUrl, backendObj});
        idx++; renderChecklist(); uploadNext();
      })
      .catch(()=>{
        idx++; uploadNext();
      });
  }
  uploadNext();
}
function uploadFileWithRetry(file,attempt) {
  return uploadFile(file).catch(e=>attempt<2?uploadFileWithRetry(file,attempt+1):Promise.reject(e));
}
async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');
  const response = await axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData, {headers:{'Content-Type':'multipart/form-data'}});
  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];
  return {docType, imageUrl, backendObj};
}

document.getElementById('main-upload-btn').onclick = ()=>{
  document.getElementById('main-file-input').value='';
  document.getElementById('main-file-input').click();
};
document.getElementById('main-file-input').onchange = function(e){
  if(e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script>
</body>
</html> -->


 





































































































































    <!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      min-height: 100vh;
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
    }
    
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    
    .btn-primary {
      background-color: #0d6efd;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 50px;
    }
    
    .document-item.completed {
      background-color: #f0fff0;
    }
    
    #scrollable-documents::-webkit-scrollbar {
      display: none;
    }
    
    #scrollable-documents {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    
    .hover-scale {
      transition: transform 0.2s ease;
    }
    
    .hover-scale:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  

    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
        <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link text-primary fw-semibold" href="#">Apply Now</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Application</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Documents</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Premium Services</a>
          </li>
        </ul>
        <div class="d-none d-md-block ms-3">
          <img src="/docs/images/people/profile-picture-3.jpg" class="rounded-circle border border-secondary" width="40" height="40" alt="User" />
        </div>
      </div>
    </div>
  </nav>

  



















  <div class="container-fluid">
    
    <div class="row mb-4 align-items-center">
      <div class="col-lg-7 mb-4 mb-lg-0">
        <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
        <p class="mt-3 text-muted">
          <span class="fst-italic text-warning fw-semibold">Upload</span> all the required docs to unlock the next step—no sneaky skips
          allowed! Peek at the <span class="fst-italic text-warning fw-semibold">Review & Errors tabs</span> to make sure our AI nailed
          the details before you blast off to the form!
        </p>
      </div>
      <div class="col-lg-5">
        <div class="d-flex flex-wrap gap-3 p-3 bg-light rounded-pill shadow-sm">
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">location_on</span>
            <span class="text-muted">United Kingdom</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">phone_iphone</span>
            <span class="text-muted">Tourism</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">visibility</span>
            <span class="text-muted">2 days</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">calendar_today</span>
            <span class="text-muted">May 19, 2025 – May 21, 2025</span>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-4 py-4 mt-4 overflow-x-auto flex-nowrap">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill border-2 border-warning text-warning px-4 py-2 fw-medium bg-white shadow-sm">Details</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Guidelines</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Upload</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Review</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Submit</div>
      </div>
    </div>

   
    <div class="row g-4 mt-2">
    
      <div class="col-lg-4">
        <div class="border rounded p-4 overflow-auto" style="max-height: 70vh;" id="scrollable-documents">
          <h2 class="h4 fw-bold d-flex align-items-center mb-4">📑 Required Documents</h2>
          <ul class="list-unstyled" id="documents-list">
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="passport">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Passport</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_funds">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Funds</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="insurance">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Insurance</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_travel">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Travel</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="letter">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Letter</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_employment">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Employment</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="photo">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Photo</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="other">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Other</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="national_id">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>National ID</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_status">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Status</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_relationship">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Relationship</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_marital_status">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Marital Status</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
            <li class="d-flex justify-content-between align-items-center mb-3 document-item" data-doc-type="proof_of_address">
              <label class="mb-0"><input type="checkbox" class="me-2" disabled>Proof of Address</label><span>(<span class="upload-count">0</span>/1)</span>
            </li>
          </ul>
        </div>
      </div>

      
      <div class="col-lg-8">
        <div class="card p-5 d-flex flex-column align-items-center justify-content-center text-center">
          <div id="upload-container" class="w-100" style="max-width: 28rem;">
            <div class="fs-1 text-muted mb-3">📄</div>
            <h3 class="h4 fw-semibold text-dark mb-2">Upload Your Documents</h3>
            <p class="text-muted small mb-4">Supported formats: PDF, JPG, PNG (Max 5MB each)</p>

            <form id="upload-form" class="mb-5">
              <label class="btn btn-warning text-white px-4 py-2 rounded-pill hover-scale">
                Select Documents
                <input type="file" id="file-input" class="d-none" multiple accept="image/*,.pdf">
              </label>
            </form>

            <div class="w-100 text-start">
              <h4 class="h6 fw-medium text-muted mb-3">Selected Documents</h4>
              <div id="selected-files" class="mb-4">
                <p class="text-muted small">No files selected</p>
              </div>
              
              <div class="d-flex justify-content-center">
                <button id="upload-button" class="btn btn-primary px-4 py-2 rounded-pill hover-scale" disabled>
                  Upload Documents
                </button>
              </div>
            </div>
          </div>

          <div id="upload-progress" class="d-none w-100 mt-4" style="max-width: 28rem;">
            <h4 class="h6 fw-medium text-muted mb-3">Uploading Documents</h4>
            <div id="upload-status"></div>
          </div>
        </div>
      </div>
    </div>

    
    <div class="custom-footer mt-5">
      <div class="footer-left">
        © Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div class="footer-right d-flex gap-2">
        <a href="indexA.html" class="btn btn-secondary">Go Back</a>
        <a href="reviewA.html" class="btn btn-primary">Start Application</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const fileInput = document.getElementById('file-input');
      const selectedFilesContainer = document.getElementById('selected-files');
      const uploadButton = document.getElementById('upload-button');
      const uploadForm = document.getElementById('upload-form');
      const uploadProgress = document.getElementById('upload-progress');
      const uploadStatus = document.getElementById('upload-status');
      const documentList = document.getElementById('documents-list');

      const documentTypes = [
        'passport', 'proof_of_funds', 'insurance', 'proof_of_travel', 
        'letter', 'proof_of_employment', 'photo', 'other', 'national_id', 
        'proof_of_status', 'proof_of_relationship', 'proof_of_marital_status', 
        'proof_of_address'
      ];

      let filesToUpload = [];

      fileInput.addEventListener('change', function(e) {
        filesToUpload = Array.from(e.target.files).filter(file => {
          if (file.size > 5 * 1024 * 1024) {
            alert(`File ${file.name} exceeds 5MB limit and will not be uploaded`);
            return false;
          }
          return true;
        });
        renderSelectedFiles();
        uploadButton.disabled = filesToUpload.length === 0;
      });

      function renderSelectedFiles() {
        selectedFilesContainer.innerHTML = '';
        if (filesToUpload.length === 0) {
          selectedFilesContainer.innerHTML = '<p class="text-muted small">No files selected</p>';
          return;
        }

        filesToUpload.forEach((file, index) => {
          const fileElement = document.createElement('div');
          fileElement.className = 'uploaded-file hover-scale mb-2';

          const fileInfo = document.createElement('div');
          fileInfo.className = 'd-flex align-items-center flex-grow-1';

          const fileName = document.createElement('div');
          fileName.className = 'uploaded-file-name';
          fileName.textContent = file.name;

          const fileSize = document.createElement('div');
          fileSize.className = 'uploaded-file-size';
          fileSize.textContent = formatFileSize(file.size);

          const fileTypeSelect = document.createElement('select');
          fileTypeSelect.className = 'form-select form-select-sm ms-2';
          fileTypeSelect.required = true;
          fileTypeSelect.innerHTML = `
            <option value="">Select document type</option>
            ${documentTypes.map(type => `<option value="${type}">${type.replace(/_/g, ' ')}</option>`).join('')}
          `;

          const removeButton = document.createElement('span');
          removeButton.className = 'uploaded-file-remove material-icons small';
          removeButton.textContent = 'close';
          removeButton.onclick = () => removeFile(index);

          fileInfo.appendChild(fileName);
          fileInfo.appendChild(fileSize);
          fileElement.appendChild(fileInfo);
          fileElement.appendChild(fileTypeSelect);
          fileElement.appendChild(removeButton);
          selectedFilesContainer.appendChild(fileElement);
        });
      }

      function removeFile(index) {
        filesToUpload.splice(index, 1);
        renderSelectedFiles();
        uploadButton.disabled = filesToUpload.length === 0;
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
      }

      uploadButton.addEventListener('click', async function() {
        const selects = selectedFilesContainer.querySelectorAll('select');
        let allSelected = true;
        
        selects.forEach(sel => {
          if (!sel.value) {
            sel.classList.add('is-invalid');
            allSelected = false;
          } else {
            sel.classList.remove('is-invalid');
          }
        });
        
        if (!allSelected) {
          alert('Please select document type for all files.');
          return;
        }

        uploadForm.classList.add('d-none');
        uploadProgress.classList.remove('d-none');
        uploadStatus.innerHTML = '';
        uploadButton.disabled = true;
        
        await uploadFilesSequentially();
      });

      async function uploadFilesSequentially() {
        const MAX_RETRIES = 3;
        const DELAY = 1000;
        const failedUploads = [];
        let successfulUploads = 0;

        for (let i = 0; i < filesToUpload.length; i++) {
          const file = filesToUpload[i];
          const fileBlock = document.createElement('div');
          fileBlock.className = 'mb-3';
          fileBlock.innerHTML = `
            <div class="d-flex justify-content-between small mb-1">
              <span>${file.name}</span>
              <span class="upload-percentage">Pending</span>
            </div>
            <div class="progress mb-1" style="height: 6px;">
              <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <div class="text-danger small error-message d-none"></div>
          `;
          uploadStatus.appendChild(fileBlock);

          const progressBar = fileBlock.querySelector('.progress-bar');
          const percentText = fileBlock.querySelector('.upload-percentage');
          const errorBox = fileBlock.querySelector('.error-message');
          let attempt = 0;
          let success = false;

          while (attempt <= MAX_RETRIES && !success) {
            try {
              await uploadSingleFile(file, progressBar, percentText);
              const docType = selectedFilesContainer.querySelectorAll('select')[i].value;
              updateDocumentStatus(docType);
              success = true;
              successfulUploads++;
            } catch (err) {
              attempt++;
              if (attempt > MAX_RETRIES) {
                percentText.textContent = 'Failed';
                progressBar.classList.remove('progress-bar');
                progressBar.classList.add('bg-danger');
                errorBox.classList.remove('d-none');
                errorBox.textContent = err.message || 'Upload failed';
                failedUploads.push(file);
              } else {
                percentText.textContent = `Retrying (${attempt}/${MAX_RETRIES})...`;
                await new Promise(r => setTimeout(r, DELAY));
              }
            }
          }
        }

        if (failedUploads.length === 0) {
          uploadStatus.innerHTML += `
            <div class="alert alert-success mt-3">
              <span class="material-icons me-2">check_circle</span>
              All documents uploaded successfully!
            </div>
            <button id="continue-button" class="btn btn-success mt-2">Continue to Application</button>
          `;
          
          document.getElementById('continue-button').addEventListener('click', function() {
            window.location.href = 'reviewA.html';
          });
        } else {
          uploadStatus.innerHTML += `
            <div class="alert alert-danger mt-3">
              ${failedUploads.length} file(s) failed to upload. Please try again.
            </div>
          `;
          uploadButton.disabled = false;
          uploadButton.textContent = 'Retry Failed Uploads';
        }
      }

      function uploadSingleFile(file, progressBar, percentText) {
        return new Promise((resolve, reject) => {
          const formData = new FormData();
          formData.append('images', file);
          formData.append('userId', 'user_1223');
          formData.append('applicantEmail', 'user@example.com');

          axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails', formData, {
            headers: { 'Content-Type': 'multipart/form-data' },
            onUploadProgress: (e) => {
              if (e.total) {
                const percent = Math.round((e.loaded * 100) / e.total);
                progressBar.style.width = percent + '%';
                percentText.textContent = percent + '%';
              }
            }
          }).then(res => {
            percentText.textContent = 'Uploaded';
            percentText.classList.add('text-success');
            progressBar.classList.add('bg-success');
            resolve(res.data);
          }).catch(err => {
            reject(new Error('Upload failed: ' + (err.response?.data?.message || err.message)));
          });
        });
      }

      function updateDocumentStatus(docType) {
        const el = document.querySelector(`.document-item[data-doc-type="${docType}"]`);
        if (el) {
          const countEl = el.querySelector('.upload-count');
          const count = parseInt(countEl.textContent);
          countEl.textContent = count + 1;
          el.querySelector('input').checked = true;
          el.classList.add('completed');
        }
      }
    });
  </script>
</body>
</html>  -->






























































































































<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Upload - The Skytrails</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    body {
  background: linear-gradient(120deg, #ffffff 0%, #f8f2f8 48%, #e9bddd 100%);
}
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* background: linear-gradient(to right, #7d7d7d, #b5b5b5); */
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      /* border-right: 1.5px solid #f6dbfc; */
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;

      scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
}

.left-panel::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}
    
    .checklist-box {
       border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    .center-panel { flex:1; height:100vh; overflow-y:auto; min-width:0; display:flex; flex-direction:column;justify-content:center;align-items:center;}
    .upload-empty-card 
    { margin:auto; margin-top:100px; max-width:444px; width:100%; border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px;   margin-left: 60px;  border:none; border-radius:99px;height:80px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      background:#fff;box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img { max-width:170px; max-height:265px;border-radius:7px;object-fit:contain; margin:0 auto 2px;}
    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    .document-item.completed { background-color: #f0fff0; }
    #scrollable-documents::-webkit-scrollbar { display: none; }
    #scrollable-documents {-ms-overflow-style: none; scrollbar-width: none;}
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    .hover-scale {
      transition: transform 0.2s ease;
    }
    .hover-scale:hover {
      transform: scale(1.05);
    }

.step-pill {
  background: rgba(255, 255, 255, 0.8);
  padding: 10px 30px;
  border-radius: 999px;
  font-weight: 500;
  font-size: 16px;
  color: #333;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
  white-space: nowrap;
}
.step-pill.active {
  background: linear-gradient(to right, #fff4ee, #ffe8cc);
  border: 2px solid #ffa043;
  color: #f97316;
  font-weight: 600;
}
.info-bar {
  display: flex;
  align-items: center;
  gap: 24px;
  padding: 12px 28px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 40px;
  font-size: 14px;
  color: #1f1f1f;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.info-bar > div {
  display: flex;
  align-items: center;
}

.info-bar i {
  font-size: 18px;
  margin-right: 6px;
  color: #333;
}

.logo-img {
  max-height: 220px;
  object-fit: contain;
  display: block;
}
  .footer-bar {
      margin-top: 3rem;
    
      /* background: linear-gradient(to right, #fbeee9, #f5e4f8); */
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: #666;
       max-width: 1140px; 
       max-height: 100px;
     
      
    

      padding: 1rem 0.5rem;
     
    }
    .footer-bar .btn {
      border-radius: 30px;
      padding: 8px 20px;
      font-weight: 600;
      margin-top: 10px;
         
    }



 
.btn-submit-custom {
      background-color: #f97316;
      color: #fff;
      border: none;
    }
    .btn-submit-custom:hover {
      background-color: #fb923c;
    }

    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }

    #main-upload-btn {
  margin-top: 20px;
  display: block;
}

#main-upload-btn {
  background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
  color: #fff;
  font-weight: 600;
  padding: 6px 16px;
  border: none;
  border-radius: 10px;
  box-shadow: 0 2px 6px #ffcba8;
}
#main-upload-btn:hover {
  background: linear-gradient(90deg, #ff6e3e 5%, #ff9800 95%);
}
.review-bar.active {
  background: linear-gradient(to right, #ffe8cc, #fff1e1);
  border-color: #ffc89e;
  color: #f97316;
}


  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg" style="background: linear-gradient(90deg, #ebe9e9 0%, #d4d4d4 55%, #e1eaff 100%); border-bottom: 1px solid #fbd8d1; padding: 14px 48px;">
  <div class="container-fluid px-0 d-flex align-items-center justify-content-between">
    

    <a class="d-flex align-items-center text-decoration-none" style="height: 44px;" href="#">
      <img src="images/logo1.png" alt="Logo" class="logo-img">
      
    </a>

   
    <div class="d-flex align-items-center gap-4">
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">Apply now</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Applications</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Documents</a>

      
      <div class="dropdown">
        <a class="dropdown-toggle text-dark fw-semibold text-decoration-none" href="#" role="button" data-bs-toggle="dropdown" style="font-size: 15px;">
          Premium Services
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#">Visa Help</a></li>
          <li><a class="dropdown-item" href="#">Consulting</a></li>
        </ul>
      </div>


      <div class="dropdown">
        <a href="#" class="d-flex align-items-center justify-content-center rounded-circle bg-light" style="width: 36px; height: 36px; font-weight: 600; font-size: 14px; color: #555;" data-bs-toggle="dropdown">
          A
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li><a class="dropdown-item" href="#">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>








<div class="container py-5">

  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
    
 
    <div class="mb-4 mb-lg-0" style="max-width: 57%;">
      <h2 class="fw-bold mb-2" style="font-size: 2.1rem;">
        Abhinandan, <span class="fw-bold">Upload Documents</span>
      </h2>
      <p class="fs-5 text-muted mb-0">
        <span class="text-warning fst-italic">Upload</span>
        all the required docs to unlock the next step—no sneaky skips allowed! Peek at the
        <span class="text-warning fst-italic">Review & Errors tabs</span>
        to make sure our AI nailed the details before you blast off to the form!
      </p>
    </div>

    <div class="info-bar">
  <div><i class="material-icons">location_on</i>United Kingdom</div>
  <div><i class="material-icons">badge</i>Tourism</div>
  <div><i class="material-icons">timer</i>29 days</div>
  <div><i class="material-icons">calendar_today</i>May 26, 2025 – Jun 24, 2025</div>
</div>

  </div>


  <div class="d-flex align-items-center gap-4 pt-5 flex-wrap flex-md-nowrap overflow-auto">
    <div class="step-pill active">Details</div>
    <div class="step-pill active">Guidelines</div>
    <div class="step-pill border border-warning text-warning bg-white fw-bold">Upload</div>
    <div class="step-pill">Review</div>
    <div class="step-pill">Submit</div>
  </div>


</div>


 
    
 <div class="container-fluid">
  
    <div class="doc-app-container">
      <!-- <aside class="left-panel">

    


        <div class="checklist-box">
          <div class="checklist-title">
            <span class="mdi mdi-lock-document-outline"></span> Upload Documents
          </div>
          <div id="doc-checklist"></div>
        </div>
      </aside> -->
     
      <aside class="left-panel">
  <!-- Upload button placed here -->
  
  <div class="checklist-box">
    <div class="checklist-title">
       <button id="main-upload-btn" class="btn btn-warning btn-sm d-flex align-items-center gap-2" style="font-weight: 600; border-radius: 8px;">
    <span class="mdi mdi-upload"></span> Upload Documents
  </button>
  <input type="file" id="main-file-input" style="display: none;" accept="image/*,.pdf" multiple />
    </div>
    <div id="doc-checklist"></div>
  </div>
</aside>


      <main class="center-panel">
        <div id="empty-upload-card" class="upload-empty-card">
          <span class="mdi mdi-file-remove-outline"></span>
          <h4>No Documents Uploaded</h4>
          <p>Start by uploading your documents here<br>to proceed with your application.</p>
          <button class="upload-btn" id="main-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
          <input type="file" id="main-file-input" style="display:none" accept="image/*,.pdf" multiple />

          
        </div>
        <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
          <div class="lds-dual-ring"></div>
          <div class="uploading-meta">Uploading your document…</div>
          <div class="uploading-file-name" id="uploading-file-name"></div>
        </div>
        <div id="doc-preview-full" style="display:none;width:100%;">
          <div class="doc-toolbar mb-1">
            <span class="doc-type-icon mdi mdi-file-document-outline"></span>
            <select id="doc-type-dropdown"></select>
            <span class="mdi mdi-chevron-right"></span>
            <span class="doc-file-id-box" id="doc-file-id-box"><span id="preview-file-name"></span><span class='mdi mdi-checkbox-marked-circle-outline'></span></span>
            <span class="doc-toolbar-btns d-flex flex-column">
              <button class="doc-toolbar-btn" title="Settings"><span class="mdi mdi-tune-variant"></span></button>
              <button class="doc-toolbar-btn" title="Zoom In"><span class="mdi mdi-magnify-plus-outline"></span></button>
              <button class="doc-toolbar-btn" title="Zoom"><span class="mdi mdi-magnify"></span></button>
            </span>
          </div>
          <div class="large-doc-preview-card">
            <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
          </div>
          <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
        </div>
      </main>
      
      <aside class="right-panel d-flex flex-column">
        <!-- <div class="review-header-row">
          <span class="review-bar">
            <span class="mdi mdi-clipboard-check-outline"></span>
            Review Details
            <span class="count-bubble" id="review-details-count">0</span>
          </span>
          <span class="review-bar" style="background:#fff5f4; color:#ec3636; border-color:#fce1e1;">
            Errors <span class="count-bubble" id="review-errors-count">0</span>
          </span>
        </div> -->
        <div id="review-errors-container">

        <div class="review-header-row">
  <span class="review-bar" id="tab-review">Review Details <span class="count-bubble" id="review-details-count">0</span></span>
  <span class="review-bar" id="tab-errors" style="background:#fff5f4; color:#ec3636;">Errors <span class="count-bubble" id="review-errors-count">0</span></span>
</div>
</div>
        
        <button class="save-edited-btn"><span class="mdi mdi-content-save-outline"></span> Save Edited Data</button>
        <form class="right-details-fields" id="right-details-fields"></form>
      </aside>
    </div>



<!-- Upload More Button (initially hidden) -->

<div id="upload-more-container" style="display: none; text-align: center; margin-top: 30px;">
  <button class="upload-btn" id="upload-more-btn">
    <span class="mdi mdi-upload"></span> Upload More Documents
  </button>
  <input type="file" id="upload-more-input" style="display: none" accept="image/*,.pdf" multiple />
</div>


      <div class="footer-bar mt-5">
      <div>
        &copy; Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div>
        <a href="indexA.html">
        <button class="btn btn-secondary me-2">Go Back</button></a>
        <a href="reviewA.html">
        <button class="btn btn-submit-custom">Submit</button></a>
      </div>
    </div>


  </div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


 <script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
  "Photo", "Account statement", "Certificate of Marriage","Marriage Certificate",
  "Aadhaar card", "Income Tax Return Acknowledgement",
  "Passbook", "Residence Permit",
  "GST Registration Document", "GSTIN Document", "Annexure B",
  "Bank Statement", "GST Document" ,"GST Registration Details",
  "Financial Statement","Emigration Check Required Document"

];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;




function matchDocType(docTypeRaw) {
  if (!docTypeRaw || typeof docTypeRaw !== "string") return "Unsorted";

  const normalized = docTypeRaw.trim().toLowerCase().replace(/[\s_]+/g, '');

  const normalizedMap = {};
  DOC_TYPES.forEach(type => {
    const key = type.toLowerCase().replace(/[\s_]+/g, '');
    normalizedMap[key] = type;
  });

 const ALIASES = {
    "gstregistrationcertificate": "GST Registration Document",
    "gstregistrationdetails": "GST Registration Document",
    "gstindocument": "GSTIN Document",
    "gstinregistrationdocument": "GSTIN Document",
    "bankaccountstatement": "Bank Statement",
    "financialstatement": "Bank Statement",
    "itreturnacknowledgement": "Income Tax Return Acknowledgement",
    "indianincometaxreturnacknowledgement": "Income Tax Return Acknowledgement",
    "marriagecertificate": "Certificate of Marriage",
    "aadhaar": "Aadhaar card",
    "aadharcard": "Aadhaar card"
  };

  if (normalizedMap[normalized]) return normalizedMap[normalized];
  
  if (ALIASES[normalized]) return ALIASES[normalized];

  for (const key in normalizedMap) {
    if (normalized.includes(key)) {
      return normalizedMap[key];
    }
  }

  console.warn("⚠️ Unknown document type received:", docTypeRaw);
  return "Unsorted";
}


function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}





function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';

  if (!curr) {
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
  const keys = Object.keys(details);

  // Check if all values are empty, null, or objects
  const allEmpty = !keys.length || keys.every(k => {
    const val = details[k];
    return !val || val === 'null' || typeof val === 'object';
  });

  if (allEmpty) {
    form.innerHTML = `<div style="font-weight: 600; font-size: 15px; color: #333;">No data available</div>`;
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  // Render fields if there is at least one valid value
  keys.forEach(k => {
    let value = details[k];
    let displayValue = 'Not available';

    if (value && value !== 'null' && typeof value !== 'object') {
      displayValue = value;
      reviewCount++;
    } else {
      errorCount++;
    }

    form.innerHTML += `
      <div class="doc-details-field">
        <label>${k}</label>
        <input type="text" readonly value="${displayValue}" />
      </div>`;
  });

  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}















function setUIState(state, filename) {

   const uploadBtn = document.getElementById('main-upload-btn');
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';

   uploadBtn.style.display = (state === 'uploading') ? 'none' : 'block';

  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}



async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  setUIState('uploading');

  const filesArray = Array.from(fileInputs);
  document.getElementById('uploading-file-name').textContent = `${filesArray.length} files selected`;

  try {
    const results = await uploadFilesWithRetry(filesArray, 0);

    results.forEach((result, index) => {
      const file = filesArray[index];
      const { docType, imageUrl, backendObj } = result;

      const assignedDocType = matchDocType(docType);
      const fileEntry = { docType: assignedDocType, fileName: file.name, imageUrl, backendObj };
      uploadedImages.push(fileEntry);
    });

    const minimalData = uploadedImages.map(file => ({
      docType: file.docType,
      fileName: file.fileName,
      imageUrl: file.imageUrl
    }));
    localStorage.setItem("uploadedDocs", JSON.stringify(minimalData));

  } catch (e) {
    console.warn(`❌ Batch upload failed: ${e.message}`);
  }

  updateMainPreview();
  renderChecklist();
  setUIState(uploadedImages.length ? 'preview' : 'empty');
  document.getElementById('upload-more-container').style.display = 'block';

}

async function uploadFilesWithRetry(files, attempt) {
  try {
    return await uploadFiles(files);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFilesWithRetry(files, attempt + 1);
    } else {
      throw err;
    }
  }
}

async function uploadFiles(files) {
  const formData = new FormData();
  files.forEach(file => formData.append('images', file));
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const detailsArray = response.data?.imageeDetails || [];
  return detailsArray.map((entry, idx) => {
    const parsed = entry?.parsedData || {};
    const docType =
      parsed["Document Type"] ||
      parsed["document_type"] ||
      parsed["DocumentType"] ||
      parsed["Document_Type"] ||
      parsed["docType"];
    return {
      docType,
      imageUrl: entry?.imageUrl,
      backendObj: entry
    };
  });
}




async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}


async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const parsed = response.data?.imageeDetails?.[0]?.parsedData || {};
  const docType =
    parsed["Document Type"] ||
    parsed["document_type"] ||
     parsed["DocumentType"] || 
    parsed["Document_Type"] ||
    parsed["docType"];

  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}


document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};


document.getElementById('upload-more-btn').onclick = () => {
  document.getElementById('upload-more-input').value = '';
  document.getElementById('upload-more-input').click();
};

document.getElementById('upload-more-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};







// Tab toggle logic
document.getElementById('tab-review').addEventListener('click', () => {
  showReviewTab();
});

document.getElementById('tab-errors').addEventListener('click', () => {
  showErrorTab();
});

function showReviewTab() {
  document.getElementById('tab-review').classList.add('active');
  document.getElementById('tab-errors').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'block';
  document.getElementById('review-errors-container').style.display = 'none';
}

function showErrorTab() {
  document.getElementById('tab-errors').classList.add('active');
  document.getElementById('tab-review').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'none';
  document.getElementById('review-errors-container').style.display = 'block';
}














setUIState('empty');
renderChecklist();
</script> 





</body>
</html>   

























































