<!-- 



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Upload - The Skytrails</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Combined styles from both codes */
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      border-right: 1.5px solid #f6dbfc;
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;
    }
    .checklist-box {
      background: #fff; border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    /* Center */
    .center-panel { flex:1; height:100vh; overflow-y:auto; min-width:0; display:flex; flex-direction:column;justify-content:center;align-items:center;}
    .upload-empty-card { margin:auto; margin-top:100px; max-width:444px; width:100%; background:rgba(255,255,255,0.97); border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px; border:none; border-radius:99px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    /* Uploading UI */
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    /* Main Preview */
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      background:#fff;box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img { max-width:170px; max-height:265px;border-radius:7px;object-fit:contain; margin:0 auto 2px;}
    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    /* Right panel */
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    /* From second code */
    .document-item.completed {
      background-color: #f0fff0;
    }
    #scrollable-documents::-webkit-scrollbar {
      display: none;
    }
    #scrollable-documents {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    .hover-scale {
      transition: transform 0.2s ease;
    }
    .hover-scale:hover {
      transform: scale(1.05);
    }
    /* Responsive */
    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
        <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link text-primary fw-semibold" href="#">Apply Now</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Application</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Documents</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Premium Services</a>
          </li>
        </ul>
        <div class="d-none d-md-block ms-3">
          <img src="/docs/images/people/profile-picture-3.jpg" class="rounded-circle border border-secondary" width="40" height="40" alt="User" />
        </div>
      </div>
    </div>
  </nav>

  
  <div class="container-fluid">

    <div class="row mb-4 align-items-center">
      <div class="col-lg-7 mb-4 mb-lg-0">
        <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
        <p class="mt-3 text-muted">
          <span class="fst-italic text-warning fw-semibold">Upload</span> all the required docs to unlock the next step—no sneaky skips
          allowed! Peek at the <span class="fst-italic text-warning fw-semibold">Review & Errors tabs</span> to make sure our AI nailed
          the details before you blast off to the form!
        </p>
      </div>
      <div class="col-lg-5">
        <div class="d-flex flex-wrap gap-3 p-3 bg-light rounded-pill shadow-sm">
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">location_on</span>
            <span class="text-muted">United Kingdom</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">phone_iphone</span>
            <span class="text-muted">Tourism</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">visibility</span>
            <span class="text-muted">2 days</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">calendar_today</span>
            <span class="text-muted">May 19, 2025 – May 21, 2025</span>
          </div>
        </div>
      </div>
    </div>


    <div class="d-flex align-items-center gap-4 py-4 mt-4 overflow-x-auto flex-nowrap">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill border-2 border-warning text-warning px-4 py-2 fw-medium bg-white shadow-sm">Details</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Guidelines</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Upload</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Review</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Submit</div>
      </div>
    </div>

  
    <div class="doc-app-container">
      <aside class="left-panel">
        <div class="checklist-box">
          <div class="checklist-title">
            <span class="mdi mdi-lock-document-outline"></span> Upload Documents
          </div>
          <div id="doc-checklist"></div>
        </div>
      </aside>

      <main class="center-panel">
        <div id="empty-upload-card" class="upload-empty-card">
          <span class="mdi mdi-file-remove-outline"></span>
          <h4>No Documents Uploaded</h4>
          <p>Start by uploading your documents here<br>to proceed with your application.</p>
          <button class="upload-btn" id="main-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
          <input type="file" id="main-file-input" style="display:none" accept="image/*,.pdf" multiple />
        </div>
        <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
          <div class="lds-dual-ring"></div>
          <div class="uploading-meta">Uploading your document…</div>
          <div class="uploading-file-name" id="uploading-file-name"></div>
        </div>
        <div id="doc-preview-full" style="display:none;width:100%;">
          <div class="doc-toolbar mb-1">
            <span class="doc-type-icon mdi mdi-file-document-outline"></span>
            <select id="doc-type-dropdown"></select>
            <span class="mdi mdi-chevron-right"></span>
            <span class="doc-file-id-box" id="doc-file-id-box"><span id="preview-file-name"></span><span class='mdi mdi-checkbox-marked-circle-outline'></span></span>
            <span class="doc-toolbar-btns d-flex flex-column">
              <button class="doc-toolbar-btn" title="Settings"><span class="mdi mdi-tune-variant"></span></button>
              <button class="doc-toolbar-btn" title="Zoom In"><span class="mdi mdi-magnify-plus-outline"></span></button>
              <button class="doc-toolbar-btn" title="Zoom"><span class="mdi mdi-magnify"></span></button>
            </span>
          </div>
          <div class="large-doc-preview-card">
            <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
          </div>
          <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
        </div>
      </main>
      
      <aside class="right-panel d-flex flex-column">
        <div class="review-header-row">
          <span class="review-bar">
            <span class="mdi mdi-clipboard-check-outline"></span>
            Review Details
            <span class="count-bubble" id="review-details-count">0</span>
          </span>
          <span class="review-bar" style="background:#fff5f4; color:#ec3636; border-color:#fce1e1;">
            Errors <span class="count-bubble" id="review-errors-count">0</span>
          </span>
        </div>
        <button class="save-edited-btn"><span class="mdi mdi-content-save-outline"></span> Save Edited Data</button>
        <form class="right-details-fields" id="right-details-fields"></form>
      </aside>
    </div>

 
    <div class="custom-footer mt-5">
      <div class="footer-left">
        © Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div class="footer-right d-flex gap-2">
        <a href="indexA.html" class="btn btn-secondary">Go Back</a>
        <a href="reviewA.html" class="btn btn-primary">Start Application</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    // Combined JavaScript from both codes
    const DOC_TYPES = [
      "Passport", "Passport front", "Passport back", "Passport stamp page", "Passport blank page", "Visa page", "Photo",
      "Account statement", "Proof of Funds", "Balance certificate", "Fixed deposit summary", "Business Balance Sheet",
      "Business Registration", "Income Tax Return", "Property Ownership", "Salary slip", "Employment Letter",
      "Insurance", "Travel insurance", "Proof of Travel", "Itinerary", "Flight ticket", "Letter", "Proof of Employment"
    ];
    let uploadedImages = []; // {docType,fileName,imageUrl,backendObj}
    let selectedDocTypeIdx = 0, selectedFileIdx = 0;

    function renderChecklist(){
      const ctn = document.getElementById('doc-checklist');
      ctn.innerHTML = '';
      DOC_TYPES.forEach((docType,dtIdx)=>{
        const files = uploadedImages.filter(x=>x.docType===docType);
        const main = document.createElement('div');
        main.className = "doc-type-row";
        main.innerHTML = `<div class="doc-type-main${dtIdx===selectedDocTypeIdx?' selected':''}" data-idx="${dtIdx}">
          <input class="doc-type-checkbox" type="checkbox" disabled ${files.length>0?'checked':''}>
          <span>${docType}</span>
          <span class="doc-type-count">(${files.length}/1) Selected</span>
        </div>
        <div class="doc-type-files"></div>`;
        const filesDiv = main.querySelector('.doc-type-files');
        files.forEach((obj,i)=>{
          const fileDiv = document.createElement('div');
          fileDiv.className = 'doc-type-file'+((dtIdx===selectedDocTypeIdx && i===selectedFileIdx)?' selected':'');
          fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName||obj.imageUrl||'Doc')}</span>`;
          fileDiv.onclick=()=>{
            selectDocFile(dtIdx, i);
          };
          filesDiv.appendChild(fileDiv);
        });
        main.querySelector('.doc-type-main').onclick=()=>{
          if(files.length) selectDocFile(dtIdx,0);
        }
        ctn.appendChild(main);
      });
    }
    
    function truncateFilename(name, maxLen=22){
      if(name.length<=maxLen)return name;
      return name.slice(0,maxLen-4)+'...'+name.split('.').pop();
    }
    
    function updateMainPreview(){
      const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
      if(!docsOfType.length){ setUIState('empty'); return; }
      setUIState('preview');
      // -- Doc type drop-down (all doc types list)
      const sel = document.getElementById('doc-type-dropdown');
      sel.innerHTML = DOC_TYPES.map((type,i)=>`<option value="${i}">${type}</option>`).join('');
      sel.value = selectedDocTypeIdx;
      sel.onchange = function(){
        // Upon changing the doc type on preview, reassign THIS file with that type!
        const oldTypeIdx = selectedDocTypeIdx, fileIdx = selectedFileIdx;
        uploadedImages
          .filter(x=>x.docType===DOC_TYPES[oldTypeIdx])[fileIdx]
          .docType = DOC_TYPES[Number(sel.value)];
        // Move to that doc type and select this same file (now moved)
        selectedDocTypeIdx = Number(sel.value);
        selectedFileIdx = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]).length-1;
        renderChecklist(); updateMainPreview();
      }
      // -- File name
      const curr = docsOfType[selectedFileIdx];
      document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
      // -- Main image preview
      document.getElementById('preview-img-main').src = curr.imageUrl;
      document.getElementById('preview-img-main').style.display = '';
      // -- File thumbs
      const thumbRow = document.getElementById('perdoc-thumb-carousel');
      thumbRow.innerHTML = '';
      docsOfType.forEach((obj,idx)=>{
        const thumb = document.createElement('img');
        thumb.src = obj.imageUrl;
        thumb.className = 'doc-thumb-carousel-img'+(idx===selectedFileIdx?' selected':'');
        thumb.onclick=()=>selectDocFile(selectedDocTypeIdx, idx);
        thumbRow.appendChild(thumb);
      });
      renderRightDetails();
      renderChecklist();
    }
    
    function selectDocFile(dtIdx, fileIdx){
      selectedDocTypeIdx=dtIdx;selectedFileIdx=fileIdx;updateMainPreview();
    }

    // --------- Right panel details
    function renderRightDetails(){
      const docsOfType = uploadedImages.filter(x=>x.docType===DOC_TYPES[selectedDocTypeIdx]);
      const curr = docsOfType[selectedFileIdx];
      const form = document.getElementById('right-details-fields');
      let reviewCount=0, errorCount=0;
      form.innerHTML='';
      if(curr){
        const details = curr.backendObj?.parsedData?.['Extracted Details']||{};
        for(const [k,v] of Object.entries(details)){
          const vv = (v!==null&&v!==undefined&&v!=='null')?v:'';
          if(vv)reviewCount++;else errorCount++;
          form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
          <input type="text" readonly value="${vv}"/></div>`;
        }
      }
      document.getElementById('review-details-count').innerText= reviewCount;
      document.getElementById('review-errors-count').innerText= errorCount;
    }
    
    // --------- Upload / state mgmt
    function setUIState(state, filename) {
      document.getElementById('empty-upload-card').style.display = (state==='empty')?'':'none';
      document.getElementById('uploading-indicator').style.display = (state==='uploading')?'':'none';
      document.getElementById('doc-preview-full').style.display = (state==='preview')?'':'none';
      if(state==='uploading') {
        document.getElementById('uploading-file-name').textContent = filename||'';
      }
    }
    
    function handleFilesSelected(fileInputs) {
      if(!fileInputs.length) return;
      let idx=0;
      function uploadNext() {
        if(idx>=fileInputs.length){
          if(uploadedImages.length){
            const {docType} = uploadedImages[uploadedImages.length-1];
            selectedDocTypeIdx = DOC_TYPES.indexOf(docType);
            const files = uploadedImages.filter(x=>x.docType===docType);
            selectedFileIdx = files.length-1;
            setUIState("preview"); updateMainPreview();
          }else setUIState('empty');
          renderChecklist();
          return;
        }
        setUIState('uploading', fileInputs[idx].name);
        uploadFileWithRetry(fileInputs[idx],0)
          .then(({docType,imageUrl,backendObj})=>{
            let assignedDocType = DOC_TYPES.find(type => type.toLowerCase() === (docType || '').trim().toLowerCase()) || DOC_TYPES[0];
            uploadedImages.push({docType: assignedDocType, fileName:fileInputs[idx].name, imageUrl, backendObj});
            idx++; renderChecklist(); uploadNext();
          })
          .catch(()=>{
            idx++; uploadNext();
          });
      }
      uploadNext();
    }
    
    function uploadFileWithRetry(file,attempt) {
      return uploadFile(file).catch(e=>attempt<2?uploadFileWithRetry(file,attempt+1):Promise.reject(e));
    }
    
    async function uploadFile(file) {
      const formData = new FormData();
      formData.append('images', file);
      formData.append('userId', 'user_1223');
      formData.append('applicantEmail', 'user@example.com');
      const response = await axios.post('https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
        formData, {headers:{'Content-Type':'multipart/form-data'}});
      const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
      const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
      const backendObj = response.data?.imageeDetails?.[0];
      return {docType, imageUrl, backendObj};
    }

    document.getElementById('main-upload-btn').onclick = ()=>{
      document.getElementById('main-file-input').value='';
      document.getElementById('main-file-input').click();
    };
    document.getElementById('main-file-input').onchange = function(e){
      if(e.target.files) handleFilesSelected(e.target.files);
    };

    // Initialize
    setUIState('empty');
    renderChecklist();
  </script>
</body>
</html>
 -->


  




















<!-- 


 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Upload - The Skytrails</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to right, #7d7d7d, #b5b5b5);
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      border-right: 1.5px solid #f6dbfc;
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;
    }
    .checklist-box {
      background: #fff; border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    .center-panel { flex:1; height:100vh; overflow-y:auto; min-width:0; display:flex; flex-direction:column;justify-content:center;align-items:center;}
    .upload-empty-card { margin:auto; margin-top:100px; max-width:444px; width:100%; background:rgba(255,255,255,0.97); border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px; border:none; border-radius:99px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      background:#fff;box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img { max-width:170px; max-height:265px;border-radius:7px;object-fit:contain; margin:0 auto 2px;}
    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    .document-item.completed { background-color: #f0fff0; }
    #scrollable-documents::-webkit-scrollbar { display: none; }
    #scrollable-documents {-ms-overflow-style: none; scrollbar-width: none;}
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    .hover-scale {
      transition: transform 0.2s ease;
    }
    .hover-scale:hover {
      transform: scale(1.05);
    }
    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="images/new_logo-01.png" alt="Logo" style="width: 60px; height: 60px;">
        <span class="ms-3 h4 mb-0 fw-bold text-dark">The Skytrails</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link text-primary fw-semibold" href="#">Apply Now</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Application</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">My Documents</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Premium Services</a>
          </li>
        </ul>
        <div class="d-none d-md-block ms-3">
          <img src="/docs/images/people/profile-picture-3.jpg" class="rounded-circle border border-secondary" width="40" height="40" alt="User" />
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
  
    <div class="row mb-4 align-items-center">
      <div class="col-lg-7 mb-4 mb-lg-0">
        <h1 class="display-4 fw-bold gradient-text">Demo: Upload Documents</h1>
        <p class="mt-3 text-muted">
          <span class="fst-italic text-warning fw-semibold">Upload</span> all the required docs to unlock the next step—no sneaky skips
          allowed! Peek at the <span class="fst-italic text-warning fw-semibold">Review & Errors tabs</span> to make sure our AI nailed
          the details before you blast off to the form!
        </p>
      </div>
      <div class="col-lg-5">
        <div class="d-flex flex-wrap gap-3 p-3 bg-light rounded-pill shadow-sm">
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">location_on</span>
            <span class="text-muted">United Kingdom</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">phone_iphone</span>
            <span class="text-muted">Tourism</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">visibility</span>
            <span class="text-muted">2 days</span>
          </div>
          <div class="vr mx-2"></div>
          <div class="d-flex align-items-center">
            <span class="material-icons text-primary me-1">calendar_today</span>
            <span class="text-muted">May 19, 2025 – May 21, 2025</span>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-4 py-4 mt-4 overflow-x-auto flex-nowrap">
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill border-2 border-warning text-warning px-4 py-2 fw-medium bg-white shadow-sm">Details</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Guidelines</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Upload</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Review</div>
        <div class="w-4 h-1 bg-secondary"></div>
      </div>
      <div class="d-flex align-items-center">
        <div class="rounded-pill bg-white px-4 py-2 fw-semibold text-dark shadow-sm">Submit</div>
      </div>
    </div>

    <div class="doc-app-container">
      <aside class="left-panel">
        <div class="checklist-box">
          <div class="checklist-title">
            <span class="mdi mdi-lock-document-outline"></span> Upload Documents
          </div>
          <div id="doc-checklist"></div>
        </div>
      </aside>

      <main class="center-panel">
        <div id="empty-upload-card" class="upload-empty-card">
          <span class="mdi mdi-file-remove-outline"></span>
          <h4>No Documents Uploaded</h4>
          <p>Start by uploading your documents here<br>to proceed with your application.</p>
          <button class="upload-btn" id="main-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
          <input type="file" id="main-file-input" style="display:none" accept="image/*,.pdf" multiple />
        </div>
        <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
          <div class="lds-dual-ring"></div>
          <div class="uploading-meta">Uploading your document…</div>
          <div class="uploading-file-name" id="uploading-file-name"></div>
        </div>
        <div id="doc-preview-full" style="display:none;width:100%;">
          <div class="doc-toolbar mb-1">
            <span class="doc-type-icon mdi mdi-file-document-outline"></span>
            <select id="doc-type-dropdown"></select>
            <span class="mdi mdi-chevron-right"></span>
            <span class="doc-file-id-box" id="doc-file-id-box"><span id="preview-file-name"></span><span class='mdi mdi-checkbox-marked-circle-outline'></span></span>
            <span class="doc-toolbar-btns d-flex flex-column">
              <button class="doc-toolbar-btn" title="Settings"><span class="mdi mdi-tune-variant"></span></button>
              <button class="doc-toolbar-btn" title="Zoom In"><span class="mdi mdi-magnify-plus-outline"></span></button>
              <button class="doc-toolbar-btn" title="Zoom"><span class="mdi mdi-magnify"></span></button>
            </span>
          </div>
          <div class="large-doc-preview-card">
            <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
          </div>
          <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
        </div>
      </main>
      
      <aside class="right-panel d-flex flex-column">
        <div class="review-header-row">
          <span class="review-bar">
            <span class="mdi mdi-clipboard-check-outline"></span>
            Review Details
            <span class="count-bubble" id="review-details-count">0</span>
          </span>
          <span class="review-bar" style="background:#fff5f4; color:#ec3636; border-color:#fce1e1;">
            Errors <span class="count-bubble" id="review-errors-count">0</span>
          </span>
        </div>
        <button class="save-edited-btn"><span class="mdi mdi-content-save-outline"></span> Save Edited Data</button>
        <form class="right-details-fields" id="right-details-fields"></form>
      </aside>
    </div>

    <div class="custom-footer mt-5">
      <div class="footer-left">
        © Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div class="footer-right d-flex gap-2">
        <a href="indexA.html" class="btn btn-secondary">Go Back</a>
        <a href="reviewA.html" class="btn btn-primary">Start Application</a>
      </div>
    </div>
  </div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
     "Photo", "Account statement", "Certificate of Marriage",
  "Aadhaar card", "Income Tax Return Acknowledgement",
  "Passbook", "Residence Permit","GST Registration Document","GSTIN Document","Annexure B",
  "Bank Statement"
];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function matchDocType(docTypeRaw) {
  if (!docTypeRaw) return "Unsorted";
  return DOC_TYPES.find(t => t.toLowerCase() === docTypeRaw.trim().toLowerCase()) || "Unsorted";
}

function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}

function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  if (curr) {
    const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
    for (const [k, v] of Object.entries(details)) {
      const vv = (v !== null && v !== undefined && v !== 'null') ? v : '';
      if (vv) reviewCount++; else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
        <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}

function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';
  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}

// ✅ FINAL robust upload handler with delay + retries
async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  setUIState('uploading');

  for (let file of fileInputs) {
    document.getElementById('uploading-file-name').textContent = file.name;

    try {
      const { docType, imageUrl, backendObj } = await uploadFileWithRetry(file, 0);
      const assignedDocType = matchDocType(docType);
      uploadedImages.push({ docType: assignedDocType, fileName: file.name, imageUrl, backendObj });
    } catch (e) {
      console.warn(`❌ Upload failed after 3 attempts: ${file.name}`);
    }

    updateMainPreview();
    renderChecklist();
  }

  setUIState(uploadedImages.length ? 'preview' : 'empty');
}


async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600)); // 600ms delay
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}


async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}

document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script>


</body>
</html>  -->






















































