
<!-- 
 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Upload - The Skytrails</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    body {
  background: linear-gradient(120deg, #ffffff 0%, #f8f2f8 48%, #e9bddd 100%);
}
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* background: linear-gradient(to right, #7d7d7d, #b5b5b5); */
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      /* border-right: 1.5px solid #f6dbfc; */
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;

      scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
}

.left-panel::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}
    
    .checklist-box {
       border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    .center-panel { flex:1; height:100vh; overflow-y:auto; min-width:0; display:flex; flex-direction:column;justify-content:center;align-items:center;}
    .upload-empty-card 
    { margin:auto; margin-top:100px; max-width:444px; width:100%; border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px;   margin-left: 60px;  border:none; border-radius:99px;height:80px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      background:#fff;box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img { max-width:170px; max-height:265px;border-radius:7px;object-fit:contain; margin:0 auto 2px;}
    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    .document-item.completed { background-color: #f0fff0; }
    #scrollable-documents::-webkit-scrollbar { display: none; }
    #scrollable-documents {-ms-overflow-style: none; scrollbar-width: none;}
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    .hover-scale {
      transition: transform 0.2s ease;
    }
    .hover-scale:hover {
      transform: scale(1.05);
    }

.step-pill {
  background: rgba(255, 255, 255, 0.8);
  padding: 10px 30px;
  border-radius: 999px;
  font-weight: 500;
  font-size: 16px;
  color: #333;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
  white-space: nowrap;
}
.step-pill.active {
  background: linear-gradient(to right, #fff4ee, #ffe8cc);
  border: 2px solid #ffa043;
  color: #f97316;
  font-weight: 600;
}



    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg" style="background: linear-gradient(90deg, #ebe9e9 0%, #d4d4d4 55%, #e1eaff 100%); border-bottom: 1px solid #fbd8d1; padding: 14px 48px;">
  <div class="container-fluid px-0 d-flex align-items-center justify-content-between">
    
  
    <a class="d-flex align-items-center text-decoration-none" href="#">
      <img src="images/logo1.png" alt="Logo" style="width: 44px; height: 44px;">
      
    </a>

   
    <div class="d-flex align-items-center gap-4">
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">Apply now</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Applications</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Documents</a>

      <div class="dropdown">
        <a class="dropdown-toggle text-dark fw-semibold text-decoration-none" href="#" role="button" data-bs-toggle="dropdown" style="font-size: 15px;">
          Premium Services
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#">Visa Help</a></li>
          <li><a class="dropdown-item" href="#">Consulting</a></li>
        </ul>
      </div>

      
      <div class="dropdown">
        <a href="#" class="d-flex align-items-center justify-content-center rounded-circle bg-light" style="width: 36px; height: 36px; font-weight: 600; font-size: 14px; color: #555;" data-bs-toggle="dropdown">
          A
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li><a class="dropdown-item" href="#">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>








<div class="container py-5">
 
  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
    
    <div class="mb-4 mb-lg-0" style="max-width: 60%;">
      <h2 class="fw-bold mb-2" style="font-size: 2.1rem;">
        Abhinandan, <span class="fw-bold">Upload Documents</span>
      </h2>
      <p class="fs-5 text-muted mb-0">
        <span class="text-warning fst-italic">Upload</span>
        all the required docs to unlock the next step—no sneaky skips allowed! Peek at the
        <span class="text-warning fst-italic">Review & Errors tabs</span>
        to make sure our AI nailed the details before you blast off to the form!
      </p>
    </div>


    <div class="mt-3 mt-lg-0">
      <div class="d-flex flex-wrap gap-2 px-3 py-2 rounded-pill shadow-sm align-items-center justify-content-end"
           style="background: rgba(255, 255, 255, 0.55); font-size: 13.5px; white-space: nowrap;">
        
        <div class="d-flex align-items-center text-dark me-2">
          <i class="material-icons me-1" style="font-size: 16px;">location_on</i>
          <span>Switzerland</span>
        </div>

        <div class="vr mx-1" style="height: 18px;"></div>

        <div class="d-flex align-items-center text-dark me-2">
          <i class="material-icons me-1" style="font-size: 16px;">badge</i>
          <span>Tourism</span>
        </div>

        <div class="vr mx-1" style="height: 18px;"></div>

        <div class="d-flex align-items-center text-dark me-2">
          <i class="material-icons me-1" style="font-size: 16px;">timer</i>
          <span>21 days</span>
        </div>

        <div class="vr mx-1" style="height: 18px;"></div>

        <div class="d-flex align-items-center text-dark">
          <i class="material-icons me-1" style="font-size: 16px;">calendar_today</i>
        
        </div>

      </div>
    </div>
  </div>


  <div class="d-flex align-items-center gap-4 pt-5 flex-wrap flex-md-nowrap overflow-auto">
    <div class="step-pill active">Details</div>
    <div class="step-pill active">Guidelines</div>
    <div class="step-pill border border-warning text-warning bg-white fw-bold">Upload</div>
    <div class="step-pill">Review</div>
    <div class="step-pill">Submit</div>
  </div>


</div>










 
    
 <div class="container-fluid">
  
    <div class="doc-app-container">
      <aside class="left-panel">
        <div class="checklist-box">
          <div class="checklist-title">
            <span class="mdi mdi-lock-document-outline"></span> Upload Documents
          </div>
          <div id="doc-checklist"></div>
        </div>
      </aside>

      <main class="center-panel">
        <div id="empty-upload-card" class="upload-empty-card">
          <span class="mdi mdi-file-remove-outline"></span>
          <h4>No Documents Uploaded</h4>
          <p>Start by uploading your documents here<br>to proceed with your application.</p>
          <button class="upload-btn" id="main-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
          <input type="file" id="main-file-input" style="display:none" accept="image/*,.pdf" multiple />
        </div>
        <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
          <div class="lds-dual-ring"></div>
          <div class="uploading-meta">Uploading your document…</div>
          <div class="uploading-file-name" id="uploading-file-name"></div>
        </div>
        <div id="doc-preview-full" style="display:none;width:100%;">
          <div class="doc-toolbar mb-1">
            <span class="doc-type-icon mdi mdi-file-document-outline"></span>
            <select id="doc-type-dropdown"></select>
            <span class="mdi mdi-chevron-right"></span>
            <span class="doc-file-id-box" id="doc-file-id-box"><span id="preview-file-name"></span><span class='mdi mdi-checkbox-marked-circle-outline'></span></span>
            <span class="doc-toolbar-btns d-flex flex-column">
              <button class="doc-toolbar-btn" title="Settings"><span class="mdi mdi-tune-variant"></span></button>
              <button class="doc-toolbar-btn" title="Zoom In"><span class="mdi mdi-magnify-plus-outline"></span></button>
              <button class="doc-toolbar-btn" title="Zoom"><span class="mdi mdi-magnify"></span></button>
            </span>
          </div>
          <div class="large-doc-preview-card">
            <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
          </div>
          <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
        </div>
      </main>
      
      <aside class="right-panel d-flex flex-column">
        <div class="review-header-row">
          <span class="review-bar">
            <span class="mdi mdi-clipboard-check-outline"></span>
            Review Details
            <span class="count-bubble" id="review-details-count">0</span>
          </span>
          <span class="review-bar" style="background:#fff5f4; color:#ec3636; border-color:#fce1e1;">
            Errors <span class="count-bubble" id="review-errors-count">0</span>
          </span>
        </div>
        <button class="save-edited-btn"><span class="mdi mdi-content-save-outline"></span> Save Edited Data</button>
        <form class="right-details-fields" id="right-details-fields"></form>
      </aside>
    </div>

    <div class="custom-footer mt-5">
      <div class="footer-left">
        © Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div class="footer-right d-flex gap-2">
        <a href="indexA.html" class="btn btn-secondary">Go Back</a>
        <a href="reviewA.html" class="btn btn-primary">Start Application</a>
      </div>
    </div>
  </div>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
     "Photo", "Account statement", "Certificate of Marriage",
  "Aadhaar card", "Income Tax Return Acknowledgement",
  "Passbook", "Residence Permit","GST Registration Document","GSTIN Document","Annexure B",
  "Bank Statement"
];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;

function matchDocType(docTypeRaw) {
  if (!docTypeRaw) return "Unsorted";
  return DOC_TYPES.find(t => t.toLowerCase() === docTypeRaw.trim().toLowerCase()) || "Unsorted";
}

function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}

function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  if (curr) {
    const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
    for (const [k, v] of Object.entries(details)) {
      const vv = (v !== null && v !== undefined && v !== 'null') ? v : '';
      if (vv) reviewCount++; else errorCount++;
      form.innerHTML += `<div class="doc-details-field"><label>${k}</label>
        <input type="text" readonly value="${vv}"/></div>`;
    }
  }
  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}

function setUIState(state, filename) {
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';
  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}

// ✅ FINAL robust upload handler with delay + retries
async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  setUIState('uploading');

  for (let file of fileInputs) {
    document.getElementById('uploading-file-name').textContent = file.name;

    try {
      const { docType, imageUrl, backendObj } = await uploadFileWithRetry(file, 0);
      const assignedDocType = matchDocType(docType);
      uploadedImages.push({ docType: assignedDocType, fileName: file.name, imageUrl, backendObj });
    } catch (e) {
      console.warn(`❌ Upload failed after 3 attempts: ${file.name}`);
    }

    updateMainPreview();
    renderChecklist();
  }

  setUIState(uploadedImages.length ? 'preview' : 'empty');
}


async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600)); // 600ms delay
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}


async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  const docType = response.data?.imageeDetails?.[0]?.parsedData?.["Document Type"];
  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}

document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};

setUIState('empty');
renderChecklist();
</script>


</body>
</html>   -->



























 <!-- <script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
  "Photo", "Account statement", "Certificate of Marriage","Marriage Certificate",
  "Aadhaar card", "Income Tax Return Acknowledgement",
  "Passbook", "Residence Permit",
  "GST Registration Document", "GSTIN Document", "Annexure B",
  "Bank Statement", "GST Document" ,"GST Registration Details",
  "Financial Statement","Emigration Check Required Document"

];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;




function matchDocType(docTypeRaw) {
  if (!docTypeRaw || typeof docTypeRaw !== "string") return "Unsorted";

  const normalized = docTypeRaw.trim().toLowerCase().replace(/[\s_]+/g, '');

  const normalizedMap = {};
  DOC_TYPES.forEach(type => {
    const key = type.toLowerCase().replace(/[\s_]+/g, '');
    normalizedMap[key] = type;
  });

 const ALIASES = {
    "gstregistrationcertificate": "GST Registration Document",
    "gstregistrationdetails": "GST Registration Document",
    "gstindocument": "GSTIN Document",
    "gstinregistrationdocument": "GSTIN Document",
    "bankaccountstatement": "Bank Statement",
    "financialstatement": "Bank Statement",
    "itreturnacknowledgement": "Income Tax Return Acknowledgement",
    "indianincometaxreturnacknowledgement": "Income Tax Return Acknowledgement",
    "marriagecertificate": "Certificate of Marriage",
    "aadhaar": "Aadhaar card",
    "aadharcard": "Aadhaar card"
  };

  if (normalizedMap[normalized]) return normalizedMap[normalized];
  
  if (ALIASES[normalized]) return ALIASES[normalized];

  for (const key in normalizedMap) {
    if (normalized.includes(key)) {
      return normalizedMap[key];
    }
  }

  console.warn("⚠️ Unknown document type received:", docTypeRaw);
  return "Unsorted";
}


function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);
  sel.onchange = function () {
    const newDocType = DOC_TYPES[Number(sel.value)];
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = uploadedImages.filter(x => x.docType === newDocType).length - 1;
    renderChecklist(); updateMainPreview();
  };

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderChecklist();
    renderDynamicErrors(); 
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}





// function renderRightDetails() {
//   const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
//   const curr = docsOfType[selectedFileIdx];
//   const form = document.getElementById('right-details-fields');
//   let reviewCount = 0, errorCount = 0;
//   form.innerHTML = '';

//   if (!curr) {
//     document.getElementById('review-details-count').innerText = 0;
//     document.getElementById('review-errors-count').innerText = 0;
//     return;
//   }

//   const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
//   const keys = Object.keys(details);

//   // Check if all values are empty, null, or objects
//   const allEmpty = !keys.length || keys.every(k => {
//     const val = details[k];
//     return !val || val === 'null' || typeof val === 'object';
//   });

//   if (allEmpty) {
//     form.innerHTML = `<div style="font-weight: 600; font-size: 15px; color: #333;">No data available</div>`;
//     document.getElementById('review-details-count').innerText = 0;
//     document.getElementById('review-errors-count').innerText = 0;
//     return;
//   }

//   // Render fields if there is at least one valid value
//   keys.forEach(k => {
//     let value = details[k];
//     let displayValue = 'Not available';

//     if (value && value !== 'null' && typeof value !== 'object') {
//       displayValue = value;
//       reviewCount++;
//     } else {
//       errorCount++;
//     }

//     form.innerHTML += `
//       <div class="doc-details-field">
//         <label>${k}</label>
//         <input type="text" readonly value="${displayValue}" />
//       </div>`;
//   });

//   document.getElementById('review-details-count').innerText = reviewCount;
//   document.getElementById('review-errors-count').innerText = errorCount;
// }







function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  const errorList = document.getElementById('dynamic-error-list');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';
  errorList.innerHTML = '';

  if (!curr) {
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
  const keys = Object.keys(details);

  const allEmpty = !keys.length || keys.every(k => {
    const val = details[k];
    return !val || val === 'null' || typeof val === 'object';
  });

  if (allEmpty) {
    form.innerHTML = `<div style="font-weight: 600; font-size: 15px; color: #333;">No data available</div>`;
    errorList.innerHTML = `<div style="margin-top: 10px;">All fields missing.</div>`;
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 1;
    return;
  }

  keys.forEach(k => {
    let value = details[k];
    let displayValue = 'Not available';
    let hasError = false;

    if (value && value !== 'null' && typeof value !== 'object') {
      displayValue = value;
      reviewCount++;
    } else {
      errorCount++;
      hasError = true;
    }

    form.innerHTML += `
      <div class="doc-details-field">
        <label>${k}</label>
        <input type="text" readonly value="${displayValue}" />
      </div>`;

    if (hasError) {
      errorList.innerHTML += `<div>⚠️ ${k} is missing or invalid.</div>`;
    }
  });

  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
  renderDynamicErrors();
}













function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  const errorBox = document.getElementById('review-errors-container');
  form.innerHTML = '';
  errorBox.innerHTML = '';

  let reviewCount = 0, errorCount = 0;
  if (!curr) return;

  const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
  const keys = Object.keys(details);

  const allEmpty = !keys.length || keys.every(k => !details[k] || details[k] === 'null' || typeof details[k] === 'object');
  if (allEmpty) {
    form.innerHTML = `<div style="font-weight: 600;">No data available</div>`;
    errorBox.innerHTML = `<div style="font-weight: 600;">No data available</div>`;
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  const errors = [];

  keys.forEach(k => {
    let value = details[k];
    let displayValue = 'Not available';
    const isFilled = value && value !== 'null' && typeof value !== 'object';

    if (isFilled) {
      displayValue = value;
      reviewCount++;
    } else {
      errorCount++;
      errors.push(`❌ Missing or unreadable: ${k}`);
    }

    form.innerHTML += `
      <div class="doc-details-field">
        <label>${k}</label>
        <input type="text" readonly value="${displayValue}" />
      </div>`;
  });

  // Display errors
  if (errors.length) {
    errorBox.innerHTML = `<div style="margin-top:8px;"><strong>Warnings (${errors.length})</strong><ul style="padding-left: 1rem;">${errors.map(e => `<li style="color:#ec3636;">${e}</li>`).join('')}</ul></div>`;
  }

  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;

  // Default to show review
  showReviewTab();
}




function setUIState(state, filename) {

   const uploadBtn = document.getElementById('main-upload-btn');
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';

   uploadBtn.style.display = (state === 'uploading') ? 'none' : 'block';

  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}



async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;
  setUIState('uploading');

  const filesArray = Array.from(fileInputs);
  document.getElementById('uploading-file-name').textContent = `${filesArray.length} files selected`;

  try {
    const results = await uploadFilesWithRetry(filesArray, 0);

    results.forEach((result, index) => {
      const file = filesArray[index];
      const { docType, imageUrl, backendObj } = result;

      const assignedDocType = matchDocType(docType);
      const fileEntry = { docType: assignedDocType, fileName: file.name, imageUrl, backendObj };
      uploadedImages.push(fileEntry);
    });

    const minimalData = uploadedImages.map(file => ({
      docType: file.docType,
      fileName: file.fileName,
      imageUrl: file.imageUrl
    }));
    localStorage.setItem("uploadedDocs", JSON.stringify(minimalData));

  } catch (e) {
    console.warn(`❌ Batch upload failed: ${e.message}`);
  }

  updateMainPreview();
  renderChecklist();
  setUIState(uploadedImages.length ? 'preview' : 'empty');
  document.getElementById('upload-more-container').style.display = 'block';
renderDynamicErrors();
}

async function uploadFilesWithRetry(files, attempt) {
  try {
    return await uploadFiles(files);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFilesWithRetry(files, attempt + 1);
    } else {
      throw err;
    }
  }
}

async function uploadFiles(files) {
  const formData = new FormData();
  files.forEach(file => formData.append('images', file));
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const detailsArray = response.data?.imageeDetails || [];
  return detailsArray.map((entry, idx) => {
    const parsed = entry?.parsedData || {};
    const docType =
      parsed["Document Type"] ||
      parsed["document_type"] ||
      parsed["DocumentType"] ||
      parsed["Document_Type"] ||
      parsed["docType"];
    return {
      docType,
      imageUrl: entry?.imageUrl,
      backendObj: entry
    };
  });
}




async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}


async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const parsed = response.data?.imageeDetails?.[0]?.parsedData || {};
  const docType =
    parsed["Document Type"] ||
    parsed["document_type"] ||
     parsed["DocumentType"] || 
    parsed["Document_Type"] ||
    parsed["docType"];

  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}


document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};


document.getElementById('upload-more-btn').onclick = () => {
  document.getElementById('upload-more-input').value = '';
  document.getElementById('upload-more-input').click();
};

document.getElementById('upload-more-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};







// Tab toggle logic
document.getElementById('tab-review').addEventListener('click', () => {
  showReviewTab();
});

document.getElementById('tab-errors').addEventListener('click', () => {
  showErrorTab();
});

function showReviewTab() {
  document.getElementById('tab-review').classList.add('active');
  document.getElementById('tab-errors').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'block';
  document.getElementById('review-errors-container').style.display = 'none';
}

function showErrorTab() {
  document.getElementById('tab-errors').classList.add('active');
  document.getElementById('tab-review').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'none';
  document.getElementById('review-errors-container').style.display = 'block';
}





function bindUploadBtn(btnId, inputId) {
  document.getElementById(btnId).onclick = () => {
    const input = document.getElementById(inputId);
    input.value = '';
    input.click();
  };
  document.getElementById(inputId).onchange = function (e) {
    if (e.target.files) handleFilesSelected(e.target.files);
  };
}

bindUploadBtn('main-upload-btn', 'main-file-input');
bindUploadBtn('center-upload-btn', 'center-file-input');



const REQUIRED_DOCS = ["Passport Front", "Passport Back", "Photo", "Aadhaar card", "Income Tax Return Acknowledgement"];

function renderDynamicErrors() {
  const errorPanel = document.getElementById("review-errors-container");
  if (!errorPanel) return;

  const uploadedTypes = uploadedImages.map(img => img.docType);
  let errorsHTML = `
    <div style="font-weight: 700; font-size: 18px; margin-bottom: 14px;">Warnings (${REQUIRED_DOCS.length})</div>
    <div style="margin-left: 4px;">`;

  const appIssues = [];
  const docIssues = [];

  if (!uploadedTypes.includes("Passport Front")) appIssues.push("⚠️ Passport front is not found");
  if (!uploadedTypes.includes("Passport Back")) appIssues.push("⚠️ Passport back is not found");
  if (!uploadedTypes.includes("Photo")) appIssues.push("⚠️ Passport-size photo not found");
  if (!uploadedTypes.includes("Aadhaar card")) docIssues.push("⚠️ Aadhaar card is not uploaded");
  if (!uploadedTypes.includes("Income Tax Return Acknowledgement")) docIssues.push("⚠️ IT Return Acknowledgement missing");

  if (appIssues.length > 0) {
    errorsHTML += `<div style="font-weight: 600; font-size: 16px; margin-top: 10px;">Application Package Issues</div>`;
    appIssues.forEach(msg => errorsHTML += `<div style="margin-top: 6px; color: #e23a3a;">${msg}</div>`);
  }

  if (docIssues.length > 0) {
    errorsHTML += `<div style="font-weight: 600; font-size: 16px; margin-top: 14px;">Document Issues</div>`;
    docIssues.forEach(msg => errorsHTML += `<div style="margin-top: 6px; color: #e23a3a;">${msg}</div>`);
  }

  errorsHTML += `</div>`;
  errorPanel.innerHTML = errorsHTML;
}


renderDynamicErrors();



setUIState('empty');
renderChecklist();
</script>  -->








































































 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Document Upload - The Skytrails</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
   <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(90deg, #fff4ee 0%, #fdeffb 55%, #e1eaff 100%);
      min-height: 100vh;
    }
    body {
  background: linear-gradient(120deg, #ffffff 0%, #f8f2f8 48%, #e9bddd 100%);
}
    .gradient-text {
      background: linear-gradient(to right, #f97316, #ec4899, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .custom-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* background: linear-gradient(to right, #7d7d7d, #b5b5b5); */
      padding: 1.5rem 2.5rem;
      border-top: 1px solid #ddd;
      font-size: 1.05rem;
      font-weight: 600;
      color: #2b2b2b;
      border-radius: 18px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 3rem;
    }
    .doc-app-container {
      display: flex;
      height: 100vh;
      min-height: 680px;
      overflow: hidden;
    }
    .left-panel {
      width: 310px;
      /* border-right: 1.5px solid #f6dbfc; */
      padding: 38px 0 36px 36px;
      background: transparent;
      height: 100vh;
      overflow-y: auto;
      position: relative;

      scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
}

.left-panel::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}
    
    .checklist-box {
       border-radius: 20px; padding: 27px 18px 20px 23px;
      box-shadow: 0 1.5px 14px #eadafd15;
    }
    .checklist-title {
      font-size: 19px; font-weight: 700; display: flex; align-items: center; gap: 9px; margin-bottom: 22px;
    }
    .doc-type-row {
      margin-bottom: 18px;
    }
    .doc-type-main {
      display: flex; align-items: center; font-size: 17px; font-weight: 600;
      gap: 6px; border-radius: 8px; padding: 2px 3px 2px 7px;
      cursor: pointer; width: 100%; min-width: 0;
    }
    .doc-type-checkbox {
      accent-color: #ff9800; width: 22px; height: 22px; margin-right: 6px;
      margin-bottom:2px;
    }
    .doc-type-count {
      color: #bfbfbf; font-size:14.7px; font-weight: 400; margin-left:auto; margin-right:7px;
    }
    .doc-type-main.selected {
      background: linear-gradient(90deg,#ffefe3 65%, #ffe5c0 100%);
      color: #e46c13; font-weight: 700;
      box-shadow:0 0 0 1.6px #ff995041;
    }
    .doc-type-files {
      margin-left: 42px; margin-top:2px; display: flex; flex-direction:column; gap:5px;
    }
    .doc-type-file {
      border-radius: 6px; padding: 4px 9px 4px 9px; font-size:15px; color:#65666a; cursor:pointer;
      min-width:0; display:flex;align-items:center;gap:6px;
      transition: background .13s, color .13s;
      background: transparent;
    }
    .doc-type-file.selected {
      background: linear-gradient(90deg,#fff1e7 60%, #ffe9be 100%);
      color:#e46c13;
      font-weight:700;
      box-shadow:0 0 0 1.2px #ff995033;
    }
    .doc-type-file .mdi {
      font-size:16px; color: #ff9800;
    }
    .doc-type-file.selected .mdi { color:#e46c13; }
    .doc-type-file span.filename {
      overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:150px;display:inline-block;
    }
    /* .center-panel 
    { 
      flex:1; 
      height:100vh; 
      overflow-y:auto;
       min-width:0;
        display:flex;
         flex-direction:column;
         justify-content:center;
         align-items:center;
        } */

        .center-panel {
  flex: 1;
  height: 100vh;
  overflow-y: auto;
  overflow-x: hidden; /* <--- This line removes the horizontal scrollbar */
  min-width: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}



    .upload-empty-card 
    { margin:auto; margin-top:100px; max-width:444px; width:100%; border-radius:17px;
      box-shadow: 0 1.5px 18px #efe0ff18; padding:40px 22px 32px 22px;
      text-align: center;
    }
    .upload-empty-card .mdi { font-size:49px;color:#a3a0a5;margin-bottom:10px;}
    .upload-empty-card .upload-btn {
      margin-top: 22px;   margin-left: 60px;  border:none; border-radius:99px;height:80px;
      background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
      color:#fff; font-size:17px; font-weight:600; padding:9px 35px; display: flex; align-items: center; gap: 11px; box-shadow:0 2px 9px #ffb37028;
    }
    .upload-empty-card .upload-btn:hover {background: linear-gradient(90deg,#ff6e3e 5%, #ff9800 95%);}
    .uploading-indicator {
      max-width:410px;width:100%;margin:auto;margin-top:75px;
      background:rgba(255,255,255,0.97);
      border-radius:10px; box-shadow:0 1px 14px #eaecf022;
      padding:34px 16px 20px;
      display: flex; flex-direction:column; align-items:center;
    }
    .lds-dual-ring {
      display: inline-block; width: 38px; height: 38px;margin-bottom:14px;
    }
    .lds-dual-ring:after {
      content:" "; display:block;
      width:38px; height:38px; border-radius:50%;
      border:4.5px solid #fbbd8a; border-color: #fbbd8a transparent #ff9021 transparent;
      animation: lds-dual-ring 1.08s linear infinite;}
    @keyframes lds-dual-ring {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    .uploading-meta {font-size:16.5px;color:#958aa2;margin-bottom:9px;}
    .uploading-file-name {font-size:15px;color:#6055ee;font-weight:500;}
    .doc-toolbar {width:100%;display:flex;align-items:center;gap:10px;margin-top:7px;margin-bottom:13px;}
    .doc-toolbar .doc-type-icon {font-size:22px;color:#ff9800;background:#fff7f0;border-radius:8px;padding:4.5px;margin-right:2px;}
    .doc-toolbar select {
      font-size:17px; font-weight:600; color:#444; background:#f9f5ef; border:none; margin:0 4px; border-radius:7px; padding:2.5px 12px 2.5px 8px;
    }
    .doc-toolbar .mdi-chevron-right {font-size:18px;}
    .doc-toolbar .doc-file-id-box {
      padding:1.5px 13px;background:#fcfdff;border-radius:8px;font-size:16px;font-weight:500;color:#e46c13;display:flex;align-items:center;gap:4px;
    }
    .doc-toolbar .mdi-checkbox-marked-circle-outline{
      font-size:19px;color:#17b43e;
    }
    .doc-toolbar .doc-toolbar-btns {
      display:flex;flex-direction:column;gap:8px;margin-left:auto;margin-right:8px;
    }
    .doc-toolbar .doc-toolbar-btn {
      background: #fff; border-radius:8px; border:none; padding:6px 11px;
      box-shadow:0 1px 8px #fec2af22; transition:0.15s;font-size:21px; color:#ff8f31; opacity:0.95; margin-bottom:1.5px;
    }
    .doc-toolbar .doc-toolbar-btn.active, .doc-toolbar .doc-toolbar-btn:hover { background: #ffe6d3; color: #fc5f17; }
    .large-doc-preview-card {
      box-shadow:0 2px 13px #eacbfd21;
      border-radius:13px; margin: 0px auto; padding: 15px 7px 10px 7px; width:295px;display:flex;flex-direction:column;align-items:center;
    }
    .large-doc-preview-img {
  width: 40%;             /* Make it scale with container */
  height: auto;            /* Maintain aspect ratio */
  max-height: 260px;       /* Optional: control max height */
  object-fit: contain;     /* Ensure full image shows */
  padding: 8px;            /* Add padding to avoid clipping */
  box-sizing: border-box;  /* Include padding in bounds */
  border-radius: 7px;
  margin: 0 auto;
}

    .doc-thumb-carousel {
      width:296px;display:flex;gap:10px;margin:14px 0 0 7px;justify-content:left;
    }
    .doc-thumb-carousel-img {
      width:37px;height:37px;border-radius: 6px;
      object-fit: cover;border:2px solid #ececec;cursor:pointer;background:#fff;transition: border .13s;
    }
    .doc-thumb-carousel-img.selected { border: 2px solid #ff9800; }
    .right-panel {
      width: 330px; background: none; padding:55px 23px 23px 25px;
      min-height:100vh;box-sizing:border-box;
    }
    .review-header-row {display:flex;align-items:center;gap:11px;margin-bottom:14px;}
    .review-bar {
      background:#fff;border-radius:10px;display:flex;flex-direction:row;gap:6px;align-items:center;
      padding:7px 12px 7px 13px;
      font-size:16px;color:#ff9021;margin-bottom:5px;border:1.15px solid #f8e0c6;font-weight:600;
    }
    .review-bar .count-bubble {
      background:#fff4e2;color:#fe973b;border-radius:7px;padding:1px 7px;font-size:13.8px;margin-left:6px;font-weight:700;
    }
    .save-edited-btn {border:none;background:none;padding:0;color:#fd8221;font-size:15px;font-weight:700;margin-bottom:10px;}
    .save-edited-btn .mdi {margin-right:3px;}
    .right-details-fields {margin-top:13px;}
    .doc-details-field {margin-bottom:12px;}
    .doc-details-field label {font-size:13.7px;font-weight:600;color:#7e7f8a;margin-bottom:2px;}
    .doc-details-field input {
      border:none;background:#f6f5fa;border-radius:8px;
      padding:5px 10px 5.5px;font-size:15.6px;font-weight:600;
      color:#444;pointer-events:none;width:100%;
    }
    .document-item.completed { background-color: #f0fff0; }
    #scrollable-documents::-webkit-scrollbar { display: none; }
    #scrollable-documents {-ms-overflow-style: none; scrollbar-width: none;}
    .uploaded-file {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8fafc;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
    }
    .uploaded-file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .uploaded-file-size {
      color: #6c757d;
      font-size: 0.8rem;
      margin-left: 8px;
    }
    .uploaded-file-remove {
      color: #dc3545;
      cursor: pointer;
      margin-left: 8px;
    }
    .hover-scale {
      transition: transform 0.2s ease;
    }
    .hover-scale:hover {
      transform: scale(1.05);
    }

.step-pill {
  background: rgba(255, 255, 255, 0.8);
  padding: 10px 30px;
  border-radius: 999px;
  font-weight: 500;
  font-size: 16px;
  color: #333;
  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.05);
  white-space: nowrap;
}
.step-pill.active {
  background: linear-gradient(to right, #fff4ee, #ffe8cc);
  border: 2px solid #ffa043;
  color: #f97316;
  font-weight: 600;
}
.info-bar {
  display: flex;
  align-items: center;
  gap: 24px;
  padding: 12px 28px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 40px;
  font-size: 14px;
  color: #1f1f1f;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.info-bar > div {
  display: flex;
  align-items: center;
}

.info-bar i {
  font-size: 18px;
  margin-right: 6px;
  color: #333;
}

.logo-img {
  max-height: 220px;
  object-fit: contain;
  display: block;
}
  .footer-bar {
      margin-top: 3rem;
    
      /* background: linear-gradient(to right, #fbeee9, #f5e4f8); */
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      color: #666;
       max-width: 1140px; 
       max-height: 100px;
     
      
    

      padding: 1rem 0.5rem;
     
    }
    .footer-bar .btn {
      border-radius: 30px;
      padding: 8px 20px;
      font-weight: 600;
      margin-top: 10px;
         
    }



 
.btn-submit-custom {
      background-color: #f97316;
      color: #fff;
      border: none;
    }
    .btn-submit-custom:hover {
      background-color: #fb923c;
    }

    @media (max-width:1080px){ .left-panel{width:158px;} .center-panel{padding:0 2px;} .right-panel{width:130px;} }
    @media (max-width:650px){ .doc-app-container{flex-direction:column;} .left-panel, .center-panel, .right-panel {width:100vw !important;min-width:0;max-width:100vw;} }

    #main-upload-btn {
  margin-top: 20px;
  display: block;
}

#main-upload-btn {
  background: linear-gradient(90deg, #ff9800 8%, #ff6e3e 92%);
  color: #fff;
  font-weight: 600;
  padding: 6px 16px;
  border: none;
  border-radius: 10px;
  box-shadow: 0 2px 6px #ffcba8;
}
#main-upload-btn:hover {
  background: linear-gradient(90deg, #ff6e3e 5%, #ff9800 95%);
}
.review-bar.active {
  background: linear-gradient(to right, #ffe8cc, #fff1e1);
  border-color: #ffc89e;
  color: #f97316;
}



.doc-toolbar {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 7px;
    margin-bottom: 13px;
  }
  .doc-type-icon {
    font-size: 20px;
    color: #ff9800;
    background: #fff7f0;
    border-radius: 8px;
    padding: 4.5px;
  }
  .doc-file-id-box {
    padding: 1.5px 10px;
    background: #fcfdff;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    color: #e46c13;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .doc-toolbar-btns {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .doc-toolbar-btn {
    background: #fff;
    border-radius: 8px;
    border: none;
    padding: 4px 8px;
    box-shadow: 0 1px 6px #fec2af22;
    transition: 0.15s;
    font-size: 18px;
    color: #ff8f31;
    opacity: 0.95;
  }
  .doc-toolbar-btn:hover {
    background: #ffe6d3;
    color: #fc5f17;
  }






.doc-toolbar-wrapper {
    background: linear-gradient(rgba(213, 213, 213, 0.1), rgba(111, 111, 111, 0.1));
  border: 1px solid #f0f0f0;
  border-radius: 14px;
  padding: 12px 16px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
  margin: 10px auto;
  max-width: 1200px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.doc-toolbar-btn {
  padding: 4px 6px;
  font-size: 16px;
}

.doc-toolbar-btns {
  gap: 4px;
}




.processing-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: url('/mnt/data/5f374ced-067d-40d0-8b9b-e95d395e01a8.png') center center / cover no-repeat;
  backdrop-filter: blur(4px);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.processing-box {
background: rgba(159, 159, 159, 0.3);
  backdrop-filter: blur(5px);
  padding: 30px 40px;
  border: 1px solid rgba(255, 255, 255, 0.7);
    
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  max-width: 400px;
  width: 90%;
  color: white;
   box-shadow: rgba(0, 0, 0, 0.37) 0px 8px 32px 0px;
}




.processing-steps {
  list-style: none;
  padding-left: 0;
  text-align: left;
  margin: 0 auto;
  max-width: 300px;
}

.processing-steps li {
  margin: 10px 0;
  font-weight: 500;
  font-size: 15.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.loader-circle {
  width: 12px;
  height: 12px;
  border: 2px solid #f97316;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0); }
  100% { transform: rotate(360deg); }
}


.processing-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.processing-box {

  padding: 30px 40px;
  border-radius: 18px;
  text-align: center;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  max-width: 400px;
  width: 90%;
}

.processing-steps {
  list-style: none;
  padding-left: 0;
  text-align: left;
  margin: 0 auto;
  max-width: 300px;
}

.processing-steps li {
  margin: 10px 0;
  font-weight: 500;
  font-size: 15.5px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.loader-circle {
  width: 12px;
  height: 12px;
  border: 2px solid #f97316;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0); }
  100% { transform: rotate(360deg); }
}






  </style> 





</head>
<body>
<nav class="navbar navbar-expand-lg" style="background: linear-gradient(90deg, #ebe9e9 0%, #d4d4d4 55%, #e1eaff 100%); border-bottom: 1px solid #fbd8d1; padding: 14px 48px;">
  <div class="container-fluid px-0 d-flex align-items-center justify-content-between">
    

    <a class="d-flex align-items-center text-decoration-none" style="height: 44px;" href="#">
      <img src="images/logo1.png" alt="Logo" class="logo-img">
      
    </a>

   
    <div class="d-flex align-items-center gap-4">
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">Apply now</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Applications</a>
      <a href="#" class="text-dark fw-semibold text-decoration-none" style="font-size: 15px;">My Documents</a>

      
      <div class="dropdown">
        <a class="dropdown-toggle text-dark fw-semibold text-decoration-none" href="#" role="button" data-bs-toggle="dropdown" style="font-size: 15px;">
          Premium Services
        </a>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="#">Visa Help</a></li>
          <li><a class="dropdown-item" href="#">Consulting</a></li>
        </ul>
      </div>


      <div class="dropdown">
        <a  id="profileInitial" href="#" class="d-flex align-items-center justify-content-center rounded-circle bg-light" style="width: 36px; height: 36px; font-weight: 600; font-size: 14px; color: #555;" data-bs-toggle="dropdown">
          A
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#">Profile</a></li>
          <li><a class="dropdown-item" href="#">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>








<div class="container py-5">

  <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
    
 
    <div class="mb-4 mb-lg-0" style="max-width: 57%;">
      <h2 id="reviewName"  class="fw-bold mb-2" style="font-size: 2.1rem;">
        Abhinandan, <span class="fw-bold">Upload Documents</span>
      </h2>
      <p class="fs-5 text-muted mb-0">
        <span class="text-warning fst-italic">Upload</span>
        all the required docs to unlock the next step—no sneaky skips allowed! Peek at the
        <span class="text-warning fst-italic">Review & Errors tabs</span>
        to make sure our AI nailed the details before you blast off to the form!
      </p>
    </div>

    <!-- <div class="info-bar">
  <div><i class="material-icons">location_on</i>United Kingdom</div>
  <div><i class="material-icons">badge</i>Tourism</div>
  <div><i class="material-icons">timer</i>29 days</div>
  <div><i class="material-icons">calendar_today</i>May 26, 2025 – Jun 24, 2025</div>
</div> -->

<div class="info-bar d-inline-flex px-4 py-2 align-items-center justify-content-start" style="background: rgba(0, 0, 0, 0.03); font-size: 12px; border-radius: 20px;">
  <div class="d-flex align-items-center me-3">
    <i class="material-icons me-1">location_on</i>
    <span id="infoDestination">Destination</span>
  </div>
  <div class="d-flex align-items-center me-3">
    <i class="material-icons me-1">badge</i>
    <span id="infoVisaType">Visa Type</span>
  </div>
  <div class="d-flex align-items-center me-3">
    <i class="material-icons me-1">timer</i>
    <span id="infoDuration">Duration</span>
  </div>
  <div class="d-flex align-items-center text-muted">
    <i class="material-icons me-1">calendar_today</i>
    <span id="infoDates">Travel Dates</span>
  </div>
</div>


  </div>


  <div class="d-flex align-items-center gap-4 pt-5 flex-wrap flex-md-nowrap overflow-auto">
    <div class="step-pill active">Details</div>
    <div class="step-pill active">Guidelines</div>
    <div class="step-pill border border-warning text-warning bg-white fw-bold">Upload</div>
    <div class="step-pill">Review</div>
    <div class="step-pill">Submit</div>
  </div>


</div>


 
<div class="doc-toolbar-wrapper">

 <div class="container-fluid">
  
    <div class="doc-app-container">
 

    


       
     
      <aside class="left-panel">

  
  <div class="checklist-box">
    <div class="checklist-title">
       <button id="main-upload-btn" class="btn btn-warning btn-sm d-flex align-items-center gap-2" style="font-weight: 600; border-radius: 8px;">
    <span class="mdi mdi-upload"></span> Upload Documents
  </button>
  <input type="file" id="main-file-input" style="display: none;" accept="image/*,.pdf" multiple />
    </div>
    <div id="doc-checklist"></div>
  </div>
</aside>


      <main class="center-panel">
        <div id="empty-upload-card" class="upload-empty-card">
          <span class="mdi mdi-file-remove-outline"></span>
          <h4>No Documents Uploaded</h4>
          <p>Start by uploading your documents here<br>to proceed with your application.</p>
        <button class="upload-btn" id="center-upload-btn"><span class="mdi mdi-upload"></span> Upload Documents</button>
<input type="file" id="center-file-input" style="display:none" accept="image/*,.pdf" multiple />

          
        </div>
        <div id="uploading-indicator" class="uploading-indicator" style="display:none;">
          <div class="lds-dual-ring"></div>
          <div class="uploading-meta">Uploading your document…</div>
          <div class="uploading-file-name" id="uploading-file-name"></div>
        </div>
        <div id="doc-preview-full" style="display:none;width:100%;">
          
<div class="doc-toolbar">
  <div class="doc-toolbar-left d-flex align-items-center" style="gap: 8px;">
    <span class="doc-type-icon mdi mdi-file-document-outline" style="font-size: 20px;"></span>
    <select id="doc-type-dropdown" style="max-width: 180px; font-size: 15px; padding: 2px 8px; border-radius: 6px; background: #f7f7f7; font-weight: 600;">
    </select>
  </div>
  <div class="d-flex align-items-center" style="gap: 8px; margin-left: auto; margin-top: -70px;">
    <span class="mdi mdi-chevron-right" style="font-size: 18px; color: #999;"></span>
    <span class="doc-file-id-box" id="doc-file-id-box">
      <span id="preview-file-name"></span>
      <span class="mdi mdi-checkbox-marked-circle-outline"></span>
    </span>
    <div class="doc-toolbar-btns d-flex flex-column">
      <button class="doc-toolbar-btn" title="Settings">
        <span class="mdi mdi-tune-variant"></span>
      </button>
      <button class="doc-toolbar-btn" title="Zoom In" onclick="zoomInImage()">
        <span class="mdi mdi-magnify-plus-outline"></span>
      </button>
      <button class="doc-toolbar-btn" title="Zoom Out" onclick="zoomOut()">
  <span class="mdi mdi-magnify-minus-outline"></span>
</button>
    </div>
  </div>
</div>

  


          <div class="large-doc-preview-card">
            <img id="preview-img-main" class="large-doc-preview-img" src="" style="display:none" alt="Preview" />
          </div>
          <div class="doc-thumb-carousel" id="perdoc-thumb-carousel"></div>
        </div>
      </main>
      
      <aside class="right-panel d-flex flex-column">
        

           <div class="review-header-row">
  <button class="review-bar" id="tab-review" onclick="toggleReviewErrorTab('review')">
    <span class="mdi mdi-clipboard-check-outline"></span>
    Review Details
    <span class="count-bubble" id="review-details-count">0</span>
  </button>
  <button class="review-bar" id="tab-errors" onclick="toggleReviewErrorTab('error')" style="background:#fff5f4; color:#ec3636;">
    Errors
    <span class="count-bubble" id="review-errors-count">0</span>
  </button>
</div>
<div id="review-tab-content">
  <form class="right-details-fields" id="right-details-fields"></form>
</div>
<div id="error-tab-content" style="display: none;">
  <div id="dynamic-error-list" style="font-size: 15px; color: #e53935; font-weight: 500;"></div>
</div>
          
          
        </div> 
         
        
        
      </aside>
    </div>
</div>



<div id="upload-more-container" style="display: none; text-align: center; margin-top: 30px;">
  
  <input type="file" id="upload-more-input" style="display: none" accept="image/*,.pdf" multiple />
</div>


      <div class="footer-bar mt-5">
      <div>
        &copy; Nuron.AI Corp. | Powered by Intellivisa
      </div>
      <div>
        <a href="indexA.html">
        <button class="btn btn-secondary me-2">Go Back</button></a>
        <a href="reviewA.html">
        <button class="btn btn-submit-custom">Submit</button></a>
      </div>
    </div>


  </div>





  <div id="file-processing-overlay" class="processing-overlay" style="display: none;">
  <div class="processing-box">
    <div class="icon mb-3">
      <img src="images/passport-docs.svg" alt="Processing Icon" width="48">
    </div>
    <h4 class="fw-bold mb-1">Processing Files</h4>
    <p class="mb-3" id="processing-counter">Processing 0 of 0 documents</p>
    <ul class="processing-steps">
      <li><span class="loader-circle"></span> Categorising your documents...</li>
      <li><span class="loader-circle"></span> Verifying your information...</li>
      <li><span class="loader-circle"></span> Validating as per guidelines...</li>
      <li><span class="loader-circle"></span> Extracting information for your application...</li>
    </ul>
  </div>
</div>


















<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>







 <script>
const DOC_TYPES = [
  "Unsorted",
  "Passport", 
  "Photo", "Account statement", "Certificate of Marriage","Marriage Certificate",
  "Aadhaar card", "Income Tax Return Acknowledgement",
  "Passbook", "Residence Permit",
  "GST Registration Document", "GSTIN Document", "Annexure B",
  "Bank Statement", "GST Document" ,"GST Registration Details",
  "Financial Statement","Emigration Check Required Document"

];

let uploadedImages = [];
let selectedDocTypeIdx = 0, selectedFileIdx = 0;




function matchDocType(docTypeRaw) {
  if (!docTypeRaw || typeof docTypeRaw !== "string") return "Unsorted";

  const normalized = docTypeRaw.trim().toLowerCase().replace(/[\s_]+/g, '');

  const normalizedMap = {};
  DOC_TYPES.forEach(type => {
    const key = type.toLowerCase().replace(/[\s_]+/g, '');
    normalizedMap[key] = type;
  });

 const ALIASES = {
    "gstregistrationcertificate": "GST Registration Document",
    "gstregistrationdetails": "GST Registration Document",
    "gstindocument": "GSTIN Document",
    "gstinregistrationdocument": "GSTIN Document",
    "bankaccountstatement": "Bank Statement",
    "financialstatement": "Bank Statement",
    "itreturnacknowledgement": "Income Tax Return Acknowledgement",
    "indianincometaxreturnacknowledgement": "Income Tax Return Acknowledgement",
    "marriagecertificate": "Certificate of Marriage",
    "aadhaar": "Aadhaar card",
    "aadharcard": "Aadhaar card"
  };

  if (normalizedMap[normalized]) return normalizedMap[normalized];
  
  if (ALIASES[normalized]) return ALIASES[normalized];

  for (const key in normalizedMap) {
    if (normalized.includes(key)) {
      return normalizedMap[key];
    }
  }

  console.warn("⚠️ Unknown document type received:", docTypeRaw);
  return "Unsorted";
}


function renderChecklist() {
  const ctn = document.getElementById('doc-checklist');
  ctn.innerHTML = '';
  DOC_TYPES.forEach((docType, dtIdx) => {
    const files = uploadedImages.filter(x => x.docType === docType);
    const main = document.createElement('div');
    main.className = "doc-type-row";
    main.innerHTML = `
      <div class="doc-type-main${dtIdx === selectedDocTypeIdx ? ' selected' : ''}" data-idx="${dtIdx}">
        <input class="doc-type-checkbox" type="checkbox" disabled ${files.length > 0 ? 'checked' : ''}>
        <span>${docType}</span>
        <span class="doc-type-count">(${files.length})</span>
      </div>
      <div class="doc-type-files"></div>`;
    const filesDiv = main.querySelector('.doc-type-files');
    files.forEach((obj, i) => {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'doc-type-file' + ((dtIdx === selectedDocTypeIdx && i === selectedFileIdx) ? ' selected' : '');
      fileDiv.innerHTML = `<span class="mdi mdi-checkbox-blank-circle"></span><span class="filename">${truncateFilename(obj.fileName || obj.imageUrl || 'Doc')}</span>`;
      fileDiv.onclick = () => { selectDocFile(dtIdx, i); };
      filesDiv.appendChild(fileDiv);
    });
    main.querySelector('.doc-type-main').onclick = () => {
      if (files.length) selectDocFile(dtIdx, 0);
    };
    ctn.appendChild(main);
  });
}

function truncateFilename(name, maxLen = 22) {
  return name.length <= maxLen ? name : name.slice(0, maxLen - 4) + '...' + name.split('.').pop();
}

function updateMainPreview() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  if (!docsOfType.length) return setUIState('empty');
  setUIState('preview');

  const sel = document.getElementById('doc-type-dropdown');
  sel.innerHTML = DOC_TYPES.map((type, i) => `<option value="${i}">${type}</option>`).join('');
  const curr = docsOfType[selectedFileIdx];
  sel.value = DOC_TYPES.indexOf(curr.docType);


 sel.onchange = function () {
  const newDocType = DOC_TYPES[Number(sel.value)];
  const docsOfType = uploadedImages.filter(x => x.docType === newDocType);

  if (docsOfType.length > 0) {
    curr.docType = newDocType;
    selectedDocTypeIdx = DOC_TYPES.indexOf(newDocType);
    selectedFileIdx = docsOfType.length - 1;
    renderChecklist();
    updateMainPreview();
  } else {
    alert(`No documents uploaded under "${newDocType}" yet.`);
    sel.value = DOC_TYPES.indexOf(curr.docType); // revert dropdown
  }
};

  document.getElementById('preview-file-name').textContent = truncateFilename(curr.fileName || curr.imageUrl || 'Document');
  document.getElementById('preview-img-main').src = curr.imageUrl;
  document.getElementById('preview-img-main').style.display = '';

  const thumbRow = document.getElementById('perdoc-thumb-carousel');
  thumbRow.innerHTML = '';
  docsOfType.forEach((obj, idx) => {
    const thumb = document.createElement('img');
    thumb.src = obj.imageUrl;
    thumb.className = 'doc-thumb-carousel-img' + (idx === selectedFileIdx ? ' selected' : '');
    thumb.onclick = () => selectDocFile(selectedDocTypeIdx, idx);
    thumbRow.appendChild(thumb);
  });

  renderRightDetails();
  renderErrorSummary();
  renderChecklist();
}

function selectDocFile(dtIdx, fileIdx) {
  selectedDocTypeIdx = dtIdx;
  selectedFileIdx = fileIdx;
  updateMainPreview();
}





function renderRightDetails() {
  const docsOfType = uploadedImages.filter(x => x.docType === DOC_TYPES[selectedDocTypeIdx]);
  const curr = docsOfType[selectedFileIdx];
  const form = document.getElementById('right-details-fields');
  let reviewCount = 0, errorCount = 0;
  form.innerHTML = '';

  if (!curr) {
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  const details = curr.backendObj?.parsedData?.['Extracted Details'] || {};
  const keys = Object.keys(details);

  // Check if all values are empty, null, or objects
  const allEmpty = !keys.length || keys.every(k => {
    const val = details[k];
    return !val || val === 'null' || typeof val === 'object';
  });

  if (allEmpty) {
    form.innerHTML = `<div style="font-weight: 600; font-size: 15px; color: #333;">No data available</div>`;
    document.getElementById('review-details-count').innerText = 0;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  // Render fields if there is at least one valid value
  keys.forEach(k => {
    let value = details[k];
    let displayValue = 'Not available';

    if (value && value !== 'null' && typeof value !== 'object') {
      displayValue = value;
      reviewCount++;
    } else {
      errorCount++;
    }

    form.innerHTML += `
      <div class="doc-details-field">
        <label>${k}</label>
        <input type="text" readonly value="${displayValue}" />
      </div>`;
  });

  document.getElementById('review-details-count').innerText = reviewCount;
  document.getElementById('review-errors-count').innerText = errorCount;
}















function setUIState(state, filename) {

   const uploadBtn = document.getElementById('main-upload-btn');
  document.getElementById('empty-upload-card').style.display = (state === 'empty') ? '' : 'none';
  document.getElementById('uploading-indicator').style.display = (state === 'uploading') ? '' : 'none';
  document.getElementById('doc-preview-full').style.display = (state === 'preview') ? '' : 'none';

   uploadBtn.style.display = (state === 'uploading') ? 'none' : 'block';

  if (state === 'uploading') {
    document.getElementById('uploading-file-name').textContent = filename || '';
  }
}



// async function handleFilesSelected(fileInputs) {
//   if (!fileInputs.length) return;
//   setUIState('uploading');

//   const filesArray = Array.from(fileInputs);
//   document.getElementById('uploading-file-name').textContent = `${filesArray.length} files selected`;

//   try {
//     const results = await uploadFilesWithRetry(filesArray, 0);

//     results.forEach((result, index) => {
//       const file = filesArray[index];
//       const { docType, imageUrl, backendObj } = result;

//       const assignedDocType = matchDocType(docType);
//       const fileEntry = { docType: assignedDocType, fileName: file.name, imageUrl, backendObj };
//       uploadedImages.push(fileEntry);
//     });

//     const minimalData = uploadedImages.map(file => ({
//       docType: file.docType,
//       fileName: file.fileName,
//       imageUrl: file.imageUrl
//     }));
//     localStorage.setItem("uploadedDocs", JSON.stringify(minimalData));

//   } catch (e) {
//     console.warn(`❌ Batch upload failed: ${e.message}`);
//   }

//   updateMainPreview();
//   renderChecklist();
//   setUIState(uploadedImages.length ? 'preview' : 'empty');
//   document.getElementById('upload-more-container').style.display = 'block';

// }








async function handleFilesSelected(fileInputs) {
  if (!fileInputs.length) return;

  // Show loader
  showProcessingOverlay(fileInputs.length);

  const filesArray = Array.from(fileInputs);
  document.getElementById('uploading-file-name').textContent = `${filesArray.length} files selected`;

  try {
    const results = await uploadFilesWithRetry(filesArray, 0);

    results.forEach((result, index) => {
      const file = filesArray[index];
      const { docType, imageUrl, backendObj } = result;

      const assignedDocType = matchDocType(docType);
      const fileEntry = { docType: assignedDocType, fileName: file.name, imageUrl, backendObj };
      uploadedImages.push(fileEntry);

      // Update overlay progress
      updateProcessingProgress(index + 1, filesArray.length);
    });

    const minimalData = uploadedImages.map(file => ({
      docType: file.docType,
      fileName: file.fileName,
      imageUrl: file.imageUrl
    }));
    localStorage.setItem("uploadedDocs", JSON.stringify(minimalData));

  } catch (e) {
    console.warn(`❌ Batch upload failed: ${e.message}`);
  }

  hideProcessingOverlay(); // Hide the overlay after upload is done

  updateMainPreview();
  renderChecklist();
  setUIState(uploadedImages.length ? 'preview' : 'empty');
  document.getElementById('upload-more-container').style.display = 'block';
}






async function uploadFilesWithRetry(files, attempt) {
  try {
    return await uploadFiles(files);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFilesWithRetry(files, attempt + 1);
    } else {
      throw err;
    }
  }
}

async function uploadFiles(files) {
  const formData = new FormData();
  files.forEach(file => formData.append('images', file));
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const detailsArray = response.data?.imageeDetails || [];
  return detailsArray.map((entry, idx) => {
    const parsed = entry?.parsedData || {};
    const docType =
      parsed["Document Type"] ||
      parsed["document_type"] ||
      parsed["DocumentType"] ||
      parsed["Document_Type"] ||
      parsed["docType"];
    return {
      docType,
      imageUrl: entry?.imageUrl,
      backendObj: entry
    };
  });
}




async function uploadFileWithRetry(file, attempt) {
  try {
    return await uploadFile(file);
  } catch (err) {
    if (attempt < 2) {
      await new Promise(res => setTimeout(res, 600));
      return await uploadFileWithRetry(file, attempt + 1);
    } else {
      throw err;
    }
  }
}


async function uploadFile(file) {
  const formData = new FormData();
  formData.append('images', file);
  formData.append('userId', 'user_1223');
  formData.append('applicantEmail', 'user@example.com');

  const response = await axios.post(
    'https://back.theskytrails.com/skyTrails/api/visa/uploadedDocsDetails',
    formData,
    { headers: { 'Content-Type': 'multipart/form-data' } }
  );

  console.log("📤 Full API response:", response.data);

  const parsed = response.data?.imageeDetails?.[0]?.parsedData || {};
  const docType =
    parsed["Document Type"] ||
    parsed["document_type"] ||
     parsed["DocumentType"] || 
    parsed["Document_Type"] ||
    parsed["docType"];

  const imageUrl = response.data?.imageeDetails?.[0]?.imageUrl;
  const backendObj = response.data?.imageeDetails?.[0];

  return { docType, imageUrl, backendObj };
}


document.getElementById('main-upload-btn').onclick = () => {
  document.getElementById('main-file-input').value = '';
  document.getElementById('main-file-input').click();
};

document.getElementById('main-file-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};


// document.getElementById('upload-more-btn').onclick = () => {
//   document.getElementById('upload-more-input').value = '';
//   document.getElementById('upload-more-input').click();
// };

document.getElementById('upload-more-input').onchange = function (e) {
  if (e.target.files) handleFilesSelected(e.target.files);
};







// Tab toggle logic
document.getElementById('tab-review').addEventListener('click', () => {
  showReviewTab();
});

document.getElementById('tab-errors').addEventListener('click', () => {
  showErrorTab();
});

function showReviewTab() {
  document.getElementById('tab-review').classList.add('active');
  document.getElementById('tab-errors').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'block';
  document.getElementById('review-errors-container').style.display = 'none';
}

function showErrorTab() {
  document.getElementById('tab-errors').classList.add('active');
  document.getElementById('tab-review').classList.remove('active');
  document.getElementById('right-details-fields').style.display = 'none';
  document.getElementById('review-errors-container').style.display = 'block';
}

function bindUploadBtn(btnId, inputId) {
  document.getElementById(btnId).onclick = () => {
    const input = document.getElementById(inputId);
    input.value = '';
    input.click();
  };
  document.getElementById(inputId).onchange = function (e) {
    if (e.target.files) handleFilesSelected(e.target.files);
  };
}

bindUploadBtn('main-upload-btn', 'main-file-input');
bindUploadBtn('center-upload-btn', 'center-file-input');





  function showProcessingOverlay(totalFiles) {
    document.getElementById('file-processing-overlay').style.display = 'flex';
    document.getElementById('processing-counter').textContent = `Processing 0 of ${totalFiles} documents`;
  }

  function updateProcessingProgress(current, total) {
    document.getElementById('processing-counter').textContent = `Processing ${current} of ${total} documents`;
  }

  function hideProcessingOverlay() {
    document.getElementById('file-processing-overlay').style.display = 'none';
  }





let currentZoomLevel = 1;
const zoomStep = 0.2;
const maxZoom = 2.5;
const minZoom = 0.5;

function applyZoom() {
  const img = document.getElementById('preview-img-main');
  if (img) {
    img.style.transform = `scale(${currentZoomLevel})`;
    img.style.transition = 'transform 0.3s ease-in-out';
    img.style.transformOrigin = 'center center';
  }
}

function zoomInImage() {
  if (currentZoomLevel < maxZoom) {
    currentZoomLevel = Math.min(currentZoomLevel + zoomStep, maxZoom);
    applyZoom();
  }
}

function zoomOut() {
  if (currentZoomLevel > minZoom) {
    currentZoomLevel = Math.max(currentZoomLevel - zoomStep, minZoom);
    applyZoom();
  }
}

function resetZoom() {
  currentZoomLevel = 1;
  applyZoom();
}






function toggleReviewErrorTab(tabType) {
  const reviewBtn = document.getElementById('tab-review');
  const errorBtn = document.getElementById('tab-errors');
  const reviewTab = document.getElementById('review-tab-content');
  const errorTab = document.getElementById('error-tab-content');
  const errorContainer = document.getElementById('dynamic-error-list');

  if (tabType === 'review') {
    reviewBtn.classList.add('active');
    errorBtn.classList.remove('active');
    reviewTab.style.display = 'block';
    errorTab.style.display = 'none';
    return;
  }

  // Switch to Error Tab
  reviewBtn.classList.remove('active');
  errorBtn.classList.add('active');
  reviewTab.style.display = 'none';
  errorTab.style.display = 'block';

  const currDocType = DOC_TYPES[selectedDocTypeIdx];
  const docs = uploadedImages.filter(x => x.docType === currDocType);
  const curr = docs[selectedFileIdx];

  const extracted = curr?.backendObj?.parsedData?.['Extracted Details'];

  if (!curr || !extracted || Object.keys(extracted).length === 0) {
    errorContainer.innerHTML = `<div style="font-weight: 600; font-size: 15px; color: #ec3636;">No extracted fields found. All fields are missing for this document.</div>`;
    document.getElementById('review-errors-count').innerText = 0;
    return;
  }

  const missingFields = Object.entries(extracted)
    .filter(([_, value]) => value == null || value === '' || value === 'null' || typeof value === 'object')
    .map(([field]) => `
      <div class="doc-details-field">
        <label>${field}</label>
        <input type="text" readonly value="Missing" style="color:#e53935; font-weight: 600;" />
      </div>
    `);

  if (missingFields.length > 0) {
    errorContainer.innerHTML = `<form class="right-details-fields">${missingFields.join('')}</form>`;
  } else {
    errorContainer.innerHTML = `<div style="color: green; font-weight: 600; font-size: 15px;">No missing fields 🎉</div>`;
  }

  document.getElementById('review-errors-count').innerText = missingFields.length;
}










// function renderErrorSummary() {
//   const errorList = document.getElementById('dynamic-error-list');
//   errorList.innerHTML = '';

//   let totalErrors = 0;
//   uploadedImages.forEach(doc => {
//     const docType = doc.docType || 'Unknown Type';
//     const fileName = doc.fileName || 'Unnamed file';
//     const details = doc.backendObj?.parsedData?.['Extracted Details'] || {};

//     Object.entries(details).forEach(([key, value]) => {
//       if (!value || value === 'null' || typeof value === 'object') {
//         totalErrors++;
//         const errorItem = document.createElement('div');
//         errorItem.innerHTML = `Missing <strong>${key}</strong> in <em>${docType}</em> (${fileName})`;
//         errorList.appendChild(errorItem);
//       }
//     });
//   });

//   const countBubble = document.getElementById('review-errors-count');
//   countBubble.innerText = totalErrors;

//   if (totalErrors === 0) {
//     errorList.innerHTML = `<div style="color: green; font-weight: 600;">No missing fields 🎉</div>`;
//   }
// }









// NEW ERROOR

// ✅ Declare your uploadedImages array


// ✅ Modified renderErrorListFromBackend to append inside #dynamic-error-list
function  renderErrorSummary() {
  const errorListDiv = document.getElementById("dynamic-error-list");
  if (!errorListDiv) return;

  errorListDiv.innerHTML = '';
  let errorCount = 0;

  uploadedImages.forEach(doc => {
    const statusCode = doc.backendObj?.statusCode;
    const errorDetails = doc.backendObj?.errors || doc.backendObj?.errorMessages || [];

    if (statusCode !== 200 || (Array.isArray(errorDetails) && errorDetails.length)) {
      const title = document.createElement("div");
      title.className = "doc-details-field";
      title.innerHTML = `<label><strong>${doc.docType || 'Unknown'} - ${doc.fileName}</strong></label>`;
      errorListDiv.appendChild(title);

      (Array.isArray(errorDetails) ? errorDetails : [`Unknown error (Status ${statusCode})`])
        .forEach(err => {
          const errorItem = document.createElement("div");
          errorItem.className = "doc-details-field";
          errorItem.innerHTML = `<input type="text" readonly value="${err}" style="color:#e53935; font-weight: 600;" />`;
          errorListDiv.appendChild(errorItem);
          errorCount++;
        });
    }
  });

  const badge = document.getElementById("review-errors-count");
  if (badge) badge.textContent = errorCount;

  if (errorCount === 0) {
    errorListDiv.innerHTML = `<div style="color: green; font-weight: 600;">All documents processed successfully 🎉</div>`;
  }

  // Also render missing doc type errors after backend errors
  renderMissingDocTypeErrors();
}

// ✅ Function to check for missing document types
function renderMissingDocTypeErrors() {
  const requiredDocTypes = [
    "Passport",
    "Photo",
    "Aadhaar card",
    "Certificate of Marriage",
    "Marriage Certificate",
    "Income Tax Return Acknowledgement",
    "Passbook",
    "Residence Permit",
    "GST Registration Document"
  ];

  const uploadedDocTypes = uploadedImages.map(doc => doc.docType);
  const missingTypes = requiredDocTypes.filter(type => !uploadedDocTypes.includes(type));

  if (missingTypes.length > 0) {
    const errorListDiv = document.getElementById("dynamic-error-list");
    if (!errorListDiv) return;

    const sectionTitle = document.createElement("div");
    sectionTitle.className = "doc-details-field";
    sectionTitle.innerHTML = `<label><strong>Missing Document Types</strong></label>`;
    errorListDiv.appendChild(sectionTitle);

    missingTypes.forEach(type => {
      const errorItem = document.createElement("div");
      errorItem.className = "doc-details-field";
      errorItem.innerHTML = `<input type="text" readonly value="${type} not uploaded" style="color:#e53935; font-weight: 600;" />`;
      errorListDiv.appendChild(errorItem);
    });

    const badge = document.getElementById("review-errors-count");
    if (badge) badge.textContent = parseInt(badge.textContent) + missingTypes.length;
  }
}

// ✅ Ensure error list rendering runs when page loads
window.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem("uploadedDocs");
  if (saved) {
    uploadedImages = JSON.parse(saved);
    renderErrorSummary();
  }
});

















document.addEventListener('DOMContentLoaded', () => {
  const signupData = JSON.parse(localStorage.getItem('signupData'));
  const visaData = JSON.parse(localStorage.getItem('visaData'));

  if (signupData?.firstName) {
    // Update name in heading
    const heading = document.getElementById('reviewName');
    if (heading) {
      heading.textContent = `${signupData.firstName}, Know before you go!`;
    }

    // Update profile initial
    const profileInitialEl = document.getElementById('profileInitial');
    if (profileInitialEl) {
      profileInitialEl.textContent = signupData.firstName.charAt(0).toUpperCase();
    }
  }

  if (visaData) {
    const destination = visaData.destinationCountry || visaData.arrCountyName || 'Unknown';
    const visaType = visaData.visaCategory || 'Tourism';
    const fromDateStr = visaData.fromDate?.split('T')[0];
    const toDateStr = visaData.toDate?.split('T')[0];

    const formatDate = (iso) => {
      const date = new Date(iso);
      const options = { year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    };

    const getDuration = (start, end) => {
      const d1 = new Date(start);
      const d2 = new Date(end);
      const diff = Math.ceil((d2 - d1) / (1000 * 60 * 60 * 24));
      return diff > 0 ? `${diff} days` : 'N/A';
    };

    document.getElementById('infoDestination').textContent = destination;
    document.getElementById('infoVisaType').textContent = visaType;
    document.getElementById('infoDuration').textContent = getDuration(fromDateStr, toDateStr);
    document.getElementById('infoDates').textContent = `${formatDate(fromDateStr)} – ${formatDate(toDateStr)}`;
  }
});



















setUIState('empty');
renderChecklist();
</script> 


</body>
</html>    










